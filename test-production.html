<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç¯å¢ƒæµ‹è¯• - 3Då¤©æ°”åº”ç”¨</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: white; border-radius: 3px; border-left: 4px solid #007bff; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¤ï¸ 3Då¤©æ°”åº”ç”¨ - ç”Ÿäº§ç¯å¢ƒæµ‹è¯•</h1>
        <p>æµ‹è¯•éƒ¨ç½²åœ¨Vercelä¸Šçš„åº”ç”¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸</p>
        
        <div class="test-section">
            <h3>ğŸ“ åœ°ç†ä½ç½®æµ‹è¯•</h3>
            <button onclick="testGeolocation()">æµ‹è¯•è·å–å½“å‰ä½ç½®</button>
            <button onclick="testWeatherByCoords()">æµ‹è¯•åæ ‡å¤©æ°”</button>
            <div id="geo-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸŒ¡ï¸ å¤©æ°”APIæµ‹è¯•</h3>
            <button onclick="testVercelAPI()">æµ‹è¯•Vercel APIè·¯ç”±</button>
            <button onclick="testDirectAPI()">æµ‹è¯•ç›´æ¥APIè°ƒç”¨</button>
            <button onclick="testSearchWeather()">æµ‹è¯•æœç´¢å¤©æ°”</button>
            <div id="api-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— åº”ç”¨é“¾æ¥</h3>
            <p><a href="https://3d-weather-codrops-main-n0fsrsx8h-ailoen1s-projects.vercel.app" target="_blank" style="color: #007bff;">æ‰“å¼€ç”Ÿäº§ç¯å¢ƒåº”ç”¨</a></p>
            <p><a href="test.html" target="_blank" style="color: #28a745;">æ‰“å¼€æœ¬åœ°æµ‹è¯•é¡µé¢</a></p>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="test-summary"></div>
        </div>
    </div>

    <script>
        const PRODUCTION_URL = 'https://3d-weather-codrops-main-n0fsrsx8h-ailoen1s-projects.vercel.app';
        let testResults = [];

        function addResult(test, success, details) {
            const result = { test, success, details, time: new Date().toLocaleTimeString() };
            testResults.push(result);
            updateSummary();
            return result;
        }

        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const total = testResults.length;
            const passed = testResults.filter(r => r.success).length;
            const failed = total - passed;
            
            summary.innerHTML = `
                <p>æ€»æµ‹è¯•æ•°: ${total}</p>
                <p class="success">é€šè¿‡: ${passed}</p>
                <p class="error">å¤±è´¥: ${failed}</p>
                <div style="margin-top: 10px;">
                    ${testResults.map(r => `
                        <div class="result" style="border-left-color: ${r.success ? '#28a745' : '#dc3545'}">
                            <strong>${r.time}</strong> - ${r.test}: 
                            <span class="${r.success ? 'success' : 'error'}">
                                ${r.success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
                            </span>
                            ${r.details ? `<br><small>${r.details}</small>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function testGeolocation() {
            const result = document.getElementById('geo-result');
            
            if (!navigator.geolocation) {
                const msg = 'æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®';
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('åœ°ç†ä½ç½®æ”¯æŒ', false, msg);
                return;
            }

            result.innerHTML = '<div class="warning">æ­£åœ¨è·å–ä½ç½®...</div>';
            
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude } = position.coords;
                    const location = `${latitude},${longitude}`;
                    const msg = `è·å–ä½ç½®æˆåŠŸ: ${location}`;
                    result.innerHTML = `<div class="success">${msg}</div>`;
                    addResult('åœ°ç†ä½ç½®è·å–', true, msg);
                    
                    // è‡ªåŠ¨æµ‹è¯•å¤©æ°”
                    await testWeatherByCoords(latitude, longitude);
                },
                (error) => {
                    const msg = `è·å–ä½ç½®å¤±è´¥: ${error.message} (ä»£ç : ${error.code})`;
                    result.innerHTML = `<div class="error">${msg}</div>`;
                    addResult('åœ°ç†ä½ç½®è·å–', false, msg);
                },
                { timeout: 10000, enableHighAccuracy: true }
            );
        }

        async function testWeatherByCoords(lat, lng) {
            if (!lat || !lng) {
                const result = document.getElementById('geo-result');
                result.innerHTML += '<div class="error">éœ€è¦å…ˆæœ‰åæ ‡</div>';
                return;
            }

            const location = `${lat},${lng}`;
            await testWeatherAPI(location, 'åæ ‡å¤©æ°”');
        }

        async function testVercelAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<div class="warning">æ­£åœ¨æµ‹è¯•Vercel APIè·¯ç”±...</div>';
            
            try {
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=Beijing`);
                const data = await response.json();
                
                if (response.ok && data.location) {
                    const msg = `Vercel APIæ­£å¸¸: ${data.location.name}, ${data.current.temp_c}Â°C`;
                    result.innerHTML = `<div class="success">${msg}</div>`;
                    addResult('Vercel APIè·¯ç”±', true, msg);
                } else {
                    const msg = `Vercel APIå¼‚å¸¸: ${response.status} - ${JSON.stringify(data)}`;
                    result.innerHTML = `<div class="error">${msg}</div>`;
                    addResult('Vercel APIè·¯ç”±', false, msg);
                }
            } catch (error) {
                const msg = `Vercel APIå¤±è´¥: ${error.message}`;
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('Vercel APIè·¯ç”±', false, msg);
            }
        }

        async function testDirectAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<div class="warning">æ­£åœ¨æµ‹è¯•ç›´æ¥APIè°ƒç”¨...</div>';
            
            try {
                const response = await fetch('https://api.weatherapi.com/v1/forecast.json?key=14b98029813d49acbc1101959251611&q=Beijing&days=3&aqi=no&alerts=no');
                const data = await response.json();
                
                if (response.ok && data.location) {
                    const msg = `ç›´æ¥APIæ­£å¸¸: ${data.location.name}, ${data.current.temp_c}Â°C`;
                    result.innerHTML = `<div class="success">${msg}</div>`;
                    addResult('ç›´æ¥APIè°ƒç”¨', true, msg);
                } else {
                    const msg = `ç›´æ¥APIå¼‚å¸¸: ${response.status} - ${JSON.stringify(data)}`;
                    result.innerHTML = `<div class="error">${msg}</div>`;
                    addResult('ç›´æ¥APIè°ƒç”¨', false, msg);
                }
            } catch (error) {
                const msg = `ç›´æ¥APIå¤±è´¥: ${error.message}`;
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('ç›´æ¥APIè°ƒç”¨', false, msg);
            }
        }

        async function testSearchWeather() {
            const location = prompt('è¯·è¾“å…¥åŸå¸‚åç§° (ä¾‹å¦‚: Beijing, Shanghai, Tokyo):', 'Shanghai');
            if (!location) return;
            
            await testWeatherAPI(location, `æœç´¢å¤©æ°”: ${location}`);
        }

        async function testWeatherAPI(location, testName) {
            const result = document.getElementById('api-result');
            result.innerHTML = `<div class="warning">æ­£åœ¨æµ‹è¯• ${testName}...</div>`;
            
            try {
                // æµ‹è¯•Vercel APIè·¯ç”±ï¼ˆå¸¦fallbacké€»è¾‘ï¼‰
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=${encodeURIComponent(location)}`);
                const data = await response.json();
                
                if (response.ok && data.location) {
                    const msg = `${testName}æˆåŠŸ: ${data.location.name}, ${data.current.temp_c}Â°C, å¤©æ°”: ${data.current.condition.text}`;
                    result.innerHTML = `<div class="success">${msg}</div>`;
                    addResult(testName, true, msg);
                } else if (data.error) {
                    // å¯èƒ½æ˜¯fallbackåˆ°äº†demoæ•°æ®
                    const msg = `${testName}ä½¿ç”¨demoæ•°æ®: ${data.error.message || 'æœªçŸ¥é”™è¯¯'}`;
                    result.innerHTML = `<div class="warning">${msg}</div>`;
                    addResult(testName, true, msg);
                } else {
                    const msg = `${testName}å¼‚å¸¸: ${response.status} - ${JSON.stringify(data)}`;
                    result.innerHTML = `<div class="error">${msg}</div>`;
                    addResult(testName, false, msg);
                }
            } catch (error) {
                const msg = `${testName}å¤±è´¥: ${error.message}`;
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult(testName, false, msg);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€äº›æµ‹è¯•
        window.addEventListener('load', () => {
            addResult('æµ‹è¯•é¡µé¢åŠ è½½', true, 'ç”Ÿäº§ç¯å¢ƒæµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>