<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆæµ‹è¯• - 3Då¤©æ°”åº”ç”¨</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { max-width: 900px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; backdrop-filter: blur(10px); }
        .test-section { margin: 25px 0; padding: 20px; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; background: rgba(255,255,255,0.05); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        button { padding: 12px 20px; margin: 8px; border: none; border-radius: 8px; cursor: pointer; background: linear-gradient(45deg, #007bff, #0056b3); color: white; font-size: 14px; transition: all 0.3s ease; }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,123,255,0.3); }
        .result { margin: 15px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid #007bff; }
        pre { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; overflow-x: auto; color: #fff; }
        .app-link { display: inline-block; padding: 15px 25px; margin: 10px 0; background: linear-gradient(45deg, #28a745, #20c997); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: all 0.3s ease; }
        .app-link:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(40,167,69,0.3); }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .status-card { padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¤ï¸ 3Då¤©æ°”åº”ç”¨ - æœ€ç»ˆæµ‹è¯•</h1>
        <p>æµ‹è¯•æœ€æ–°éƒ¨ç½²çš„Vercelåº”ç”¨æ˜¯å¦å®Œå…¨ä¿®å¤</p>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>ğŸš€ åº”ç”¨åœ°å€</h3>
                <a href="https://3d-weather-codrops-main-p1t6imqel-ailoen1s-projects.vercel.app" target="_blank" class="app-link">æ‰“å¼€ç”Ÿäº§ç¯å¢ƒåº”ç”¨</a>
            </div>
            <div class="status-card">
                <h3>ğŸ“Š æµ‹è¯•ç»Ÿè®¡</h3>
                <div id="test-stats">ç­‰å¾…æµ‹è¯•...</div>
            </div>
            <div class="status-card">
                <h3>âš¡ çŠ¶æ€</h3>
                <div id="overall-status" class="warning">æœªæµ‹è¯•</div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ åœ°ç†ä½ç½®ä¸å¤©æ°”åŠ è½½æµ‹è¯•</h3>
            <button onclick="testFullGeolocation()">ğŸŒ å®Œæ•´åœ°ç†ä½ç½®æµ‹è¯•</button>
            <button onclick="testManualLocation()">ğŸ™ï¸ æ‰‹åŠ¨ä½ç½®æµ‹è¯•</button>
            <button onclick="testWeatherAPIs()">ğŸ”§ APIæ¥å£å¯¹æ¯”æµ‹è¯•</button>
            <div id="geo-test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸŒ¡ï¸ å¤©æ°”æ•°æ®æ˜¾ç¤ºæµ‹è¯•</h3>
            <button onclick="testWeatherDisplay()">ğŸ“‹ å¤©æ°”æ•°æ®å®Œæ•´æ€§æµ‹è¯•</button>
            <button onclick="testUnits()">ğŸŒ¡ï¸ å•ä½è½¬æ¢æµ‹è¯•</button>
            <button onclick="testForecast()">ğŸ“… é¢„æŠ¥æ•°æ®æµ‹è¯•</button>
            <div id="weather-test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ” æœç´¢åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="testSearchFunction()">ğŸ” æœç´¢åŠŸèƒ½æµ‹è¯•</button>
            <button onclick="testInvalidLocation()">âŒ æ— æ•ˆä½ç½®æµ‹è¯•</button>
            <div id="search-test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š ç»¼åˆæµ‹è¯•æŠ¥å‘Š</h3>
            <button onclick="runAllTests()">ğŸ¯ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
            <div id="comprehensive-report"></div>
        </div>
    </div>

    <script>
        const PRODUCTION_URL = 'https://3d-weather-codrops-main-p1t6imqel-ailoen1s-projects.vercel.app';
        let testResults = [];
        let allTestsPassed = false;

        function updateStats() {
            const total = testResults.length;
            const passed = testResults.filter(r => r.success).length;
            const failed = total - passed;
            const percentage = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            document.getElementById('test-stats').innerHTML = `
                <div>æ€»æµ‹è¯•: ${total}</div>
                <div class="success">âœ… é€šè¿‡: ${passed}</div>
                <div class="error">âŒ å¤±è´¥: ${failed}</div>
                <div class="info">ğŸ“ˆ æˆåŠŸç‡: ${percentage}%</div>
            `;
            
            const statusEl = document.getElementById('overall-status');
            if (total === 0) {
                statusEl.className = 'warning';
                statusEl.textContent = 'æœªæµ‹è¯•';
            } else if (failed === 0 && total > 0) {
                statusEl.className = 'success';
                statusEl.textContent = 'å…¨éƒ¨é€šè¿‡';
                allTestsPassed = true;
            } else {
                statusEl.className = 'error';
                statusEl.textContent = 'éƒ¨åˆ†å¤±è´¥';
                allTestsPassed = false;
            }
        }

        function addResult(test, success, details, data = null) {
            const result = { 
                test, 
                success, 
                details, 
                data,
                time: new Date().toLocaleTimeString() 
            };
            testResults.push(result);
            updateStats();
            return result;
        }

        async function testFullGeolocation() {
            const result = document.getElementById('geo-test-result');
            result.innerHTML = '<div class="warning">ğŸŒ æ­£åœ¨æµ‹è¯•åœ°ç†ä½ç½®åŠŸèƒ½...</div>';
            
            if (!navigator.geolocation) {
                const msg = 'âŒ æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®';
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('æµè§ˆå™¨åœ°ç†ä½ç½®æ”¯æŒ', false, msg);
                return;
            }

            addResult('æµè§ˆå™¨åœ°ç†ä½ç½®æ”¯æŒ', true, 'âœ… æ”¯æŒ');

            return new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude, accuracy } = position.coords;
                        const location = `${latitude.toFixed(4)},${longitude.toFixed(4)}`;
                        const msg = `âœ… è·å–ä½ç½®æˆåŠŸ: ${location} (ç²¾åº¦: ${accuracy.toFixed(0)}m)`;
                        
                        result.innerHTML = `<div class="success">${msg}</div>`;
                        addResult('åœ°ç†ä½ç½®è·å–', true, msg, { latitude, longitude, accuracy });
                        
                        // æµ‹è¯•å¤©æ°”API
                        await testWeatherForLocation(location, 'è‡ªåŠ¨ä½ç½®');
                        resolve();
                    },
                    (error) => {
                        const msg = `âŒ è·å–ä½ç½®å¤±è´¥: ${error.message} (ä»£ç : ${error.code})`;
                        result.innerHTML = `<div class="error">${msg}</div>`;
                        addResult('åœ°ç†ä½ç½®è·å–', false, msg, { error: error.message, code: error.code });
                        resolve();
                    },
                    { timeout: 15000, enableHighAccuracy: true, maximumAge: 60000 }
                );
            });
        }

        async function testManualLocation() {
            const locations = ['Beijing', 'Shanghai', 'Tokyo', 'New York', 'London'];
            const randomLocation = locations[Math.floor(Math.random() * locations.length)];
            const result = document.getElementById('geo-test-result');
            
            result.innerHTML = `<div class="warning">ğŸ™ï¸ æ­£åœ¨æµ‹è¯•æ‰‹åŠ¨ä½ç½®: ${randomLocation}...</div>`;
            await testWeatherForLocation(randomLocation, 'æ‰‹åŠ¨ä½ç½®');
        }

        async function testWeatherForLocation(location, testType) {
            const result = document.getElementById('geo-test-result');
            
            try {
                // æµ‹è¯•Vercel APIè·¯ç”±ï¼ˆåŒ…å«fallbacké€»è¾‘ï¼‰
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=${encodeURIComponent(location)}`);
                const data = await response.json();
                
                if (response.ok && data.location) {
                    const weatherInfo = `${data.location.name}, ${data.current.temp_c}Â°C, ${data.current.condition.text}, æ¹¿åº¦: ${data.current.humidity}%`;
                    const msg = `âœ… ${testType}å¤©æ°”åŠ è½½æˆåŠŸ: ${weatherInfo}`;
                    result.innerHTML += `<div class="success">${msg}</div>`;
                    addResult(`${testType}å¤©æ°”åŠ è½½`, true, msg, data);
                    return true;
                } else if (data.error) {
                    // å¯èƒ½æ˜¯fallbackåˆ°äº†demoæ•°æ®
                    const msg = `âš ï¸ ${testType}ä½¿ç”¨demoæ•°æ®: ${data.error.message || 'æœªçŸ¥é”™è¯¯'}`;
                    result.innerHTML += `<div class="warning">${msg}</div>`;
                    addResult(`${testType}å¤©æ°”åŠ è½½`, true, msg, data);
                    return true;
                } else {
                    const msg = `âŒ ${testType}å¤©æ°”åŠ è½½å¼‚å¸¸: ${response.status} - ${JSON.stringify(data)}`;
                    result.innerHTML += `<div class="error">${msg}</div>`;
                    addResult(`${testType}å¤©æ°”åŠ è½½`, false, msg, data);
                    return false;
                }
            } catch (error) {
                const msg = `âŒ ${testType}å¤©æ°”åŠ è½½å¤±è´¥: ${error.message}`;
                result.innerHTML += `<div class="error">${msg}</div>`;
                addResult(`${testType}å¤©æ°”åŠ è½½`, false, msg, { error: error.message });
                return false;
            }
        }

        async function testWeatherAPIs() {
            const result = document.getElementById('geo-test-result');
            result.innerHTML = '<div class="warning">ğŸ”§ æ­£åœ¨å¯¹æ¯”æµ‹è¯•APIæ¥å£...</div>';
            
            const testLocation = 'Beijing';
            let vercelSuccess = false;
            let directSuccess = false;
            
            // æµ‹è¯•Vercel APIè·¯ç”±
            try {
                const vercelResponse = await fetch(`${PRODUCTION_URL}/api/weather?location=${testLocation}`);
                const vercelData = await vercelResponse.json();
                
                if (vercelResponse.ok && vercelData.location) {
                    addResult('Vercel APIè·¯ç”±', true, `âœ… æ­£å¸¸: ${vercelData.location.name}`, vercelData);
                    vercelSuccess = true;
                } else {
                    addResult('Vercel APIè·¯ç”±', false, `âŒ å¼‚å¸¸: ${vercelResponse.status}`, vercelData);
                }
            } catch (error) {
                addResult('Vercel APIè·¯ç”±', false, `âŒ å¤±è´¥: ${error.message}`);
            }
            
            // æµ‹è¯•ç›´æ¥APIè°ƒç”¨
            try {
                const directResponse = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=14b98029813d49acbc1101959251611&q=${testLocation}&days=3&aqi=no&alerts=no`);
                const directData = await directResponse.json();
                
                if (directResponse.ok && directData.location) {
                    addResult('ç›´æ¥APIè°ƒç”¨', true, `âœ… æ­£å¸¸: ${directData.location.name}`, directData);
                    directSuccess = true;
                } else {
                    addResult('ç›´æ¥APIè°ƒç”¨', false, `âŒ å¼‚å¸¸: ${directResponse.status}`, directData);
                }
            } catch (error) {
                addResult('ç›´æ¥APIè°ƒç”¨', false, `âŒ å¤±è´¥: ${error.message}`);
            }
            
            if (vercelSuccess) {
                result.innerHTML = '<div class="success">âœ… Vercel APIè·¯ç”±å·¥ä½œæ­£å¸¸ï¼Œfallbacké€»è¾‘æœ‰æ•ˆ</div>';
            } else if (directSuccess) {
                result.innerHTML = '<div class="warning">âš ï¸ Vercel APIè·¯ç”±å¤±è´¥ï¼Œä½†ç›´æ¥APIå¯ç”¨ï¼Œfallbacké€»è¾‘ç”Ÿæ•ˆ</div>';
            } else {
                result.innerHTML = '<div class="error">âŒ ä¸¤ä¸ªAPIæ¥å£éƒ½å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ç½‘ç»œå’Œé…ç½®</div>';
            }
        }

        async function testWeatherDisplay() {
            const result = document.getElementById('weather-test-result');
            result.innerHTML = '<div class="warning">ğŸ“‹ æ­£åœ¨æµ‹è¯•å¤©æ°”æ•°æ®å®Œæ•´æ€§...</div>';
            
            try {
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=Shanghai`);
                const data = await response.json();
                
                if (!response.ok || !data.location) {
                    throw new Error('æ— æ³•è·å–å¤©æ°”æ•°æ®');
                }
                
                const checks = [
                    { name: 'ä½ç½®ä¿¡æ¯', test: data.location && data.location.name },
                    { name: 'å½“å‰å¤©æ°”', test: data.current && data.current.temp_c !== undefined },
                    { name: 'å¤©æ°”çŠ¶å†µ', test: data.current && data.current.condition && data.current.condition.text },
                    { name: 'æ¹¿åº¦ä¿¡æ¯', test: data.current && data.current.humidity !== undefined },
                    { name: 'é£é€Ÿä¿¡æ¯', test: data.current && data.current.wind_kph !== undefined },
                    { name: 'é¢„æŠ¥æ•°æ®', test: data.forecast && data.forecast.forecastday && data.forecast.forecastday.length > 0 }
                ];
                
                let allPassed = true;
                let report = '<h4>ğŸ“Š æ•°æ®å®Œæ•´æ€§æ£€æŸ¥:</h4>';
                
                checks.forEach(check => {
                    const passed = Boolean(check.test);
                    const icon = passed ? 'âœ…' : 'âŒ';
                    const color = passed ? 'success' : 'error';
                    report += `<div class="${color}">${icon} ${check.name}</div>`;
                    if (!passed) allPassed = false;
                });
                
                result.innerHTML = report;
                addResult('å¤©æ°”æ•°æ®å®Œæ•´æ€§', allPassed, allPassed ? 'âœ… æ‰€æœ‰æ•°æ®å­—æ®µå®Œæ•´' : 'âŒ éƒ¨åˆ†æ•°æ®ç¼ºå¤±', data);
                
            } catch (error) {
                const msg = `âŒ å¤©æ°”æ•°æ®æµ‹è¯•å¤±è´¥: ${error.message}`;
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('å¤©æ°”æ•°æ®å®Œæ•´æ€§', false, msg);
            }
        }

        async function testUnits() {
            const result = document.getElementById('weather-test-result');
            result.innerHTML = '<div class="warning">ğŸŒ¡ï¸ æ­£åœ¨æµ‹è¯•å•ä½è½¬æ¢...</div>';
            
            try {
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=Beijing`);
                const data = await response.json();
                
                if (!response.ok || !data.current) {
                    throw new Error('æ— æ³•è·å–å¤©æ°”æ•°æ®');
                }
                
                const current = data.current;
                const checks = [
                    { name: 'æ‘„æ°åº¦', value: current.temp_c, expected: current.temp_c !== undefined && current.temp_c < 50 },
                    { name: 'åæ°åº¦', value: current.temp_f, expected: current.temp_f !== undefined },
                    { name: 'é£é€Ÿkm/h', value: current.wind_kph, expected: current.wind_kph !== undefined },
                    { name: 'é£é€Ÿmph', value: current.wind_mph, expected: current.wind_mph !== undefined },
                    { name: 'èƒ½è§åº¦km', value: current.vis_km, expected: current.vis_km !== undefined },
                    { name: 'èƒ½è§åº¦miles', value: current.vis_miles, expected: current.vis_miles !== undefined }
                ];
                
                let report = '<h4>ğŸŒ¡ï¸ å•ä½è½¬æ¢æ£€æŸ¥:</h4>';
                let metricUnitsOk = true;
                
                checks.forEach(check => {
                    const passed = check.expected;
                    const icon = passed ? 'âœ…' : 'âŒ';
                    const color = passed ? 'success' : 'error';
                    const valueStr = check.value !== undefined ? check.value : 'N/A';
                    report += `<div class="${color}">${icon} ${check.name}: ${valueStr}</div>`;
                    
                    // é‡ç‚¹æ£€æŸ¥å…¬åˆ¶å•ä½
                    if (check.name.includes('æ‘„æ°åº¦') || check.name.includes('km/h') || check.name.includes('èƒ½è§åº¦km')) {
                        if (!passed) metricUnitsOk = false;
                    }
                });
                
                result.innerHTML = report;
                addResult('å•ä½è½¬æ¢(å…¬åˆ¶)', metricUnitsOk, metricUnitsOk ? 'âœ… å…¬åˆ¶å•ä½æ­£å¸¸' : 'âŒ å…¬åˆ¶å•ä½å¼‚å¸¸', data);
                
            } catch (error) {
                const msg = `âŒ å•ä½æµ‹è¯•å¤±è´¥: ${error.message}`;
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('å•ä½è½¬æ¢', false, msg);
            }
        }

        async function testForecast() {
            const result = document.getElementById('weather-test-result');
            result.innerHTML = '<div class="warning">ğŸ“… æ­£åœ¨æµ‹è¯•é¢„æŠ¥æ•°æ®...</div>';
            
            try {
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=Tokyo`);
                const data = await response.json();
                
                if (!response.ok || !data.forecast || !data.forecast.forecastday) {
                    throw new Error('æ— æ³•è·å–é¢„æŠ¥æ•°æ®');
                }
                
                const forecastDays = data.forecast.forecastday;
                const dayCount = forecastDays.length;
                const hasToday = dayCount > 0;
                const hasTomorrow = dayCount > 1;
                
                const checks = [
                    { name: 'é¢„æŠ¥å¤©æ•°', passed: dayCount >= 1 },
                    { name: 'ä»Šæ—¥é¢„æŠ¥', passed: hasToday && forecastDays[0].day },
                    { name: 'æ˜æ—¥é¢„æŠ¥', passed: hasTomorrow && forecastDays[1].day },
                    { name: 'æ¸©åº¦èŒƒå›´', passed: hasToday && forecastDays[0].day.maxtemp_c !== undefined && forecastDays[0].day.mintemp_c !== undefined }
                ];
                
                let allPassed = checks.every(check => check.passed);
                let report = `<h4>ğŸ“… é¢„æŠ¥æ•°æ®æ£€æŸ¥ (${dayCount}å¤©):</h4>`;
                
                checks.forEach(check => {
                    const icon = check.passed ? 'âœ…' : 'âŒ';
                    const color = check.passed ? 'success' : 'error';
                    report += `<div class="${color}">${icon} ${check.name}</div>`;
                });
                
                if (hasToday) {
                    const today = forecastDays[0].day;
                    report += `<div class="info">ğŸ“Š ä»Šæ—¥: ${today.maxtemp_c}Â°C / ${today.mintemp_c}Â°C, ${today.condition.text}</div>`;
                }
                
                result.innerHTML = report;
                addResult('é¢„æŠ¥æ•°æ®å®Œæ•´æ€§', allPassed, allPassed ? 'âœ… é¢„æŠ¥æ•°æ®å®Œæ•´' : 'âŒ é¢„æŠ¥æ•°æ®ç¼ºå¤±', data);
                
            } catch (error) {
                const msg = `âŒ é¢„æŠ¥æµ‹è¯•å¤±è´¥: ${error.message}`;
                result.innerHTML = `<div class="error">${msg}</div>`;
                addResult('é¢„æŠ¥æ•°æ®', false, msg);
            }
        }

        async function testSearchFunction() {
            const result = document.getElementById('search-test-result');
            const location = prompt('è¯·è¾“å…¥åŸå¸‚åç§°æµ‹è¯•æœç´¢åŠŸèƒ½:', 'Guangzhou');
            if (!location) return;
            
            result.innerHTML = `<div class="warning">ğŸ” æ­£åœ¨æµ‹è¯•æœç´¢: ${location}...</div>`;
            await testWeatherForLocation(location, 'æœç´¢åŠŸèƒ½');
        }

        async function testInvalidLocation() {
            const result = document.getElementById('search-test-result');
            const invalidLocation = 'InvalidCityName12345';
            
            result.innerHTML = `<div class="warning">âŒ æ­£åœ¨æµ‹è¯•æ— æ•ˆä½ç½®: ${invalidLocation}...</div>`;
            
            try {
                const response = await fetch(`${PRODUCTION_URL}/api/weather?location=${invalidLocation}`);
                const data = await response.json();
                
                if (!response.ok) {
                    // åº”è¯¥è¿”å›é”™è¯¯çŠ¶æ€
                    addResult('æ— æ•ˆä½ç½®å¤„ç†', true, `âœ… æ­£ç¡®å¤„ç†æ— æ•ˆä½ç½®: ${response.status}`, data);
                    result.innerHTML = '<div class="success">âœ… æ— æ•ˆä½ç½®å¤„ç†æ­£å¸¸</div>';
                } else {
                    // å¦‚æœè¿”å›äº†200ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯demoæ•°æ®
                    if (data.error) {
                        addResult('æ— æ•ˆä½ç½®å¤„ç†', true, 'âœ… è¿”å›é”™è¯¯ä¿¡æ¯', data);
                        result.innerHTML = '<div class="success">âœ… æ— æ•ˆä½ç½®è¿”å›é”™è¯¯ä¿¡æ¯</div>';
                    } else {
                        addResult('æ— æ•ˆä½ç½®å¤„ç†', false, 'âŒ æ— æ•ˆä½ç½®æœªæ­£ç¡®å¤„ç†', data);
                        result.innerHTML = '<div class="error">âŒ æ— æ•ˆä½ç½®æœªæ­£ç¡®å¤„ç†</div>';
                    }
                }
            } catch (error) {
                addResult('æ— æ•ˆä½ç½®å¤„ç†', true, `âœ… æ­£ç¡®æ‹’ç»æ— æ•ˆä½ç½®: ${error.message}`);
                result.innerHTML = '<div class="success">âœ… æ— æ•ˆä½ç½®å¤„ç†æ­£å¸¸</div>';
            }
        }

        async function runAllTests() {
            const result = document.getElementById('comprehensive-report');
            result.innerHTML = '<div class="warning">ğŸ¯ æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...</div>';
            
            testResults = []; // é‡ç½®ç»“æœ
            allTestsPassed = false;
            
            const tests = [
                { name: 'åœ°ç†ä½ç½®', func: testFullGeolocation },
                { name: 'APIæ¥å£', func: testWeatherAPIs },
                { name: 'æ•°æ®æ˜¾ç¤º', func: testWeatherDisplay },
                { name: 'å•ä½è½¬æ¢', func: testUnits },
                { name: 'é¢„æŠ¥æ•°æ®', func: testForecast },
                { name: 'æœç´¢åŠŸèƒ½', func: () => testWeatherForLocation('Shenzhen', 'æœç´¢åŠŸèƒ½') }
            ];
            
            let passedTests = 0;
            
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                result.innerHTML = `<div class="warning">ğŸ”„ æ­£åœ¨è¿›è¡Œ: ${test.name}æµ‹è¯• (${i+1}/${tests.length})...</div>`;
                
                try {
                    await test.func();
                    // æ£€æŸ¥æœ€åä¸€æ¬¡æµ‹è¯•æ˜¯å¦é€šè¿‡
                    const lastResult = testResults[testResults.length - 1];
                    if (lastResult && lastResult.success) {
                        passedTests++;
                    }
                } catch (error) {
                    addResult(test.name, false, `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`);
                }
                
                // å°å»¶è¿Ÿè®©UIæ›´æ–°
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            allTestsPassed = passedTests === tests.length;
            const overallIcon = allTestsPassed ? 'âœ…' : 'âš ï¸';
            const overallClass = allTestsPassed ? 'success' : 'warning';
            
            result.innerHTML = `
                <div class="${overallClass}">
                    <h3>${overallIcon} æµ‹è¯•å®Œæˆ</h3>
                    <p>æ€»æµ‹è¯•é¡¹: ${tests.length}</p>
                    <p>é€šè¿‡: ${passedTests}</p>
                    <p>çŠ¶æ€: ${allTestsPassed ? 'å…¨éƒ¨é€šè¿‡ âœ…' : 'éƒ¨åˆ†å¤±è´¥ âš ï¸'}</p>
                </div>
            `;
            
            // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
            generateDetailedReport();
        }

        function generateDetailedReport() {
            const result = document.getElementById('comprehensive-report');
            const total = testResults.length;
            const passed = testResults.filter(r => r.success).length;
            const failed = total - passed;
            
            let report = `
                <div class="test-section">
                    <h3>ğŸ“‹ è¯¦ç»†æµ‹è¯•æŠ¥å‘Š</h3>
                    <div class="info">æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}</div>
                    <div class="info">åº”ç”¨åœ°å€: ${PRODUCTION_URL}</div>
                    <div class="success">âœ… é€šè¿‡: ${passed}</div>
                    <div class="error">âŒ å¤±è´¥: ${failed}</div>
                    <div class="info">ğŸ“Š æˆåŠŸç‡: ${Math.round((passed/total)*100)}%</div>
                    
                    <h4>ğŸ” æµ‹è¯•ç»“æœè¯¦æƒ…:</h4>
            `;
            
            testResults.forEach((r, index) => {
                const icon = r.success ? 'âœ…' : 'âŒ';
                const color = r.success ? 'success' : 'error';
                report += `
                    <div class="result ${color}">
                        <strong>${index + 1}. ${r.test}</strong><br>
                        <small>æ—¶é—´: ${r.time}</small><br>
                        ${icon} ${r.details}
                    </div>
                `;
            });
            
            report += '</div>';
            result.innerHTML += report;
        }

        function clearResults() {
            testResults = [];
            allTestsPassed = false;
            document.getElementById('geo-test-result').innerHTML = '';
            document.getElementById('weather-test-result').innerHTML = '';
            document.getElementById('search-test-result').innerHTML = '';
            document.getElementById('comprehensive-report').innerHTML = '';
            updateStats();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            addResult('æµ‹è¯•ç³»ç»Ÿ', true, 'âœ… æœ€ç»ˆæµ‹è¯•ç³»ç»Ÿå·²åŠ è½½');
            updateStats();
        });
    </script>
</body>
</html>