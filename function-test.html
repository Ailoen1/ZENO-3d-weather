<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Då¤©æ°”åº”ç”¨ - åŠŸèƒ½æµ‹è¯•ä¸éªŒè¯</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #333; 
            min-height: 100vh; 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            backdrop-filter: blur(10px); 
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
        }
        .header h1 { 
            color: #2c3e50; 
            margin-bottom: 10px; 
            font-size: 2.5em; 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 25px; 
            margin: 30px 0; 
        }
        .test-section { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
            border: 1px solid #e9ecef; 
            transition: transform 0.3s ease; 
        }
        .test-section:hover { 
            transform: translateY(-5px); 
        }
        .test-section h3 { 
            color: #495057; 
            margin-bottom: 20px; 
            font-size: 1.3em; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .test-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 15px; 
            margin: 8px 0; 
            background: #f8f9fa; 
            border-radius: 8px; 
            border-left: 4px solid #e9ecef; 
            transition: all 0.3s ease; 
        }
        .test-item:hover { 
            background: #e9ecef; 
            transform: translateX(5px); 
        }
        .test-item.pass { 
            border-left-color: #28a745; 
            background: #d4edda; 
        }
        .test-item.fail { 
            border-left-color: #dc3545; 
            background: #f8d7da; 
        }
        .test-item.warning { 
            border-left-color: #ffc107; 
            background: #fff3cd; 
        }
        .status { 
            font-weight: bold; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 0.9em; 
        }
        .status.pass { color: #28a745; background: #d4edda; }
        .status.fail { color: #dc3545; background: #f8d7da; }
        .status.warning { color: #856404; background: #fff3cd; }
        .status.info { color: #0c5460; background: #d1ecf1; }
        button { 
            padding: 12px 20px; 
            margin: 8px 5px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            font-size: 14px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .btn-primary { 
            background: linear-gradient(45deg, #007bff, #0056b3); 
            color: white; 
            box-shadow: 0 4px 15px rgba(0,123,255,0.3); 
        }
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(0,123,255,0.4); 
        }
        .btn-secondary { 
            background: linear-gradient(45deg, #6c757d, #545b62); 
            color: white; 
        }
        .btn-success { 
            background: linear-gradient(45deg, #28a745, #1e7e34); 
            color: white; 
        }
        .btn-warning { 
            background: linear-gradient(45deg, #ffc107, #e0a800); 
            color: #212529; 
        }
        .progress-bar { 
            width: 100%; 
            height: 8px; 
            background: #e9ecef; 
            border-radius: 4px; 
            overflow: hidden; 
            margin: 15px 0; 
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(45deg, #28a745, #20c997); 
            transition: width 0.3s ease; 
        }
        .summary-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 25px; 
            border-radius: 15px; 
            margin: 20px 0; 
            text-align: center; 
        }
        .summary-card h3 { 
            margin-bottom: 15px; 
            font-size: 1.5em; 
        }
        .feature-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .feature-item { 
            padding: 15px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 10px; 
            text-align: center; 
            border: 1px solid rgba(255,255,255,0.2); 
        }
        .weather-demo { 
            width: 100%; 
            height: 300px; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            margin: 15px 0; 
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.2em; 
            color: white; 
            position: relative; 
            overflow: hidden; 
        }
        .loading { 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #007bff; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-right: 10px; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .weather-animation { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            top: 0; 
            left: 0; 
        }
        .rain-drop { 
            position: absolute; 
            width: 2px; 
            height: 20px; 
            background: rgba(255,255,255,0.6); 
            animation: rain 1s linear infinite; 
        }
        @keyframes rain { 
            0% { transform: translateY(-20px); opacity: 1; } 
            100% { transform: translateY(320px); opacity: 0; } 
        }
        .cloud { 
            position: absolute; 
            width: 60px; 
            height: 20px; 
            background: rgba(255,255,255,0.8); 
            border-radius: 20px; 
            animation: cloud-move 10s linear infinite; 
        }
        @keyframes cloud-move { 
            0% { transform: translateX(-60px); } 
            100% { transform: translateX(100%); } 
        }
        .api-response { 
            background: #f8f9fa; 
            border: 1px solid #e9ecef; 
            border-radius: 8px; 
            padding: 15px; 
            margin: 10px 0; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 200px; 
            overflow-y: auto; 
        }
        .test-log { 
            background: #2c3e50; 
            color: #ecf0f1; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 300px; 
            overflow-y: auto; 
            margin: 10px 0; 
        }
        .log-entry { 
            margin: 2px 0; 
            padding: 2px 0; 
        }
        .log-success { color: #2ecc71; }
        .log-error { color: #e74c3c; }
        .log-warning { color: #f39c12; }
        .log-info { color: #3498db; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¤ï¸ 3Då¤©æ°”åº”ç”¨ - åŠŸèƒ½æµ‹è¯•ä¸éªŒè¯</h1>
            <p>å…¨é¢æµ‹è¯•3Då¤©æ°”åº”ç”¨çš„å„é¡¹åŠŸèƒ½å’Œæ€§èƒ½è¡¨ç°</p>
        </div>

        <div class="test-grid">
            <!-- 3Dæ¸²æŸ“æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ® 3Dæ¸²æŸ“åŠŸèƒ½æµ‹è¯•</h3>
                <div class="weather-demo" id="weather-demo">
                    <div class="loading"></div>
                    æ­£åœ¨åŠ è½½3Då¤©æ°”æ¼”ç¤º...
                </div>
                <button class="btn-primary" onclick="test3DRendering()">æµ‹è¯•3Dæ¸²æŸ“</button>
                <button class="btn-secondary" onclick="testWeatherEffects()">å¤©æ°”ç‰¹æ•ˆ</button>
                <button class="btn-warning" onclick="testPerformance()">æ€§èƒ½æµ‹è¯•</button>
                <div id="rendering-results"></div>
            </div>

            <!-- APIåŠŸèƒ½æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸŒ å¤©æ°”APIåŠŸèƒ½æµ‹è¯•</h3>
                <div style="margin: 15px 0;">
                    <input type="text" id="location-input" placeholder="è¾“å…¥åŸå¸‚åç§°" value="Beijing" 
                           style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 200px;">
                    <button class="btn-primary" onclick="testWeatherAPI()">æµ‹è¯•å¤©æ°”API</button>
                    <button class="btn-secondary" onclick="testMultipleCities()">å¤šåŸå¸‚æµ‹è¯•</button>
                </div>
                <div id="api-results"></div>
                <div id="api-response" class="api-response" style="display: none;"></div>
            </div>

            <!-- ç”¨æˆ·ç•Œé¢æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ–¼ï¸ ç”¨æˆ·ç•Œé¢æµ‹è¯•</h3>
                <button class="btn-primary" onclick="testUIComponents()">UIç»„ä»¶æµ‹è¯•</button>
                <button class="btn-secondary" onclick="testResponsiveDesign()">å“åº”å¼è®¾è®¡</button>
                <button class="btn-warning" onclick="testAccessibility()">æ— éšœç¢æµ‹è¯•</button>
                <div id="ui-results"></div>
            </div>

            <!-- äº¤äº’åŠŸèƒ½æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ¯ äº¤äº’åŠŸèƒ½æµ‹è¯•</h3>
                <button class="btn-primary" onclick="testUserInteractions()">ç”¨æˆ·äº¤äº’</button>
                <button class="btn-secondary" onclick="testFormValidation()">è¡¨å•éªŒè¯</button>
                <button class="btn-warning" onclick="testErrorHandling()">é”™è¯¯å¤„ç†</button>
                <div id="interaction-results"></div>
            </div>

            <!-- æ€§èƒ½åŸºå‡†æµ‹è¯• -->
            <div class="test-section">
                <h3>âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯•</h3>
                <button class="btn-primary" onclick="testLoadTime()">åŠ è½½æ—¶é—´</button>
                <button class="btn-secondary" onclick="testMemoryUsage()">å†…å­˜ä½¿ç”¨</button>
                <button class="btn-warning" onclick="testFPS()">å¸§ç‡æµ‹è¯•</button>
                <div id="performance-results"></div>
            </div>

            <!-- ç½‘ç»œå…¼å®¹æ€§æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸŒ ç½‘ç»œå…¼å®¹æ€§æµ‹è¯•</h3>
                <button class="btn-primary" onclick="testNetworkConditions()">ç½‘ç»œæ¡ä»¶</button>
                <button class="btn-secondary" onclick="testOfflineMode()">ç¦»çº¿æ¨¡å¼</button>
                <button class="btn-warning" onclick="testCaching()">ç¼“å­˜æµ‹è¯•</button>
                <div id="network-results"></div>
            </div>
        </div>

        <!-- ç»¼åˆæµ‹è¯•æŠ¥å‘Š -->
        <div class="summary-card">
            <h3>ğŸ“Š åŠŸèƒ½æµ‹è¯•ç»¼åˆæŠ¥å‘Š</h3>
            <div id="overall-score" style="font-size: 3em; font-weight: bold; margin: 15px 0;">--</div>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress"></div>
            </div>
            <div id="test-summary"></div>
        </div>

        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <button class="btn-primary" onclick="clearTestLog()">æ¸…ç©ºæ—¥å¿—</button>
            <button class="btn-secondary" onclick="exportTestLog()">å¯¼å‡ºæ—¥å¿—</button>
            <div id="test-log" class="test-log"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn-success" onclick="runAllFunctionTests()">ğŸš€ è¿è¡Œæ‰€æœ‰åŠŸèƒ½æµ‹è¯•</button>
            <button class="btn-warning" onclick="location.reload()">ğŸ”„ é‡æ–°åŠ è½½</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let testResults = [];
        let testLog = [];
        let performanceMetrics = {};

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { timestamp, message, type };
            testLog.push(logEntry);
            
            const logDiv = document.getElementById('test-log');
            const logClass = `log-${type}`;
            logDiv.innerHTML += `<div class="log-entry ${logClass}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearTestLog() {
            testLog = [];
            document.getElementById('test-log').innerHTML = '';
            log('æµ‹è¯•æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        function exportTestLog() {
            const report = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                testResults: testResults,
                testLog: testLog,
                performanceMetrics: performanceMetrics
            };

            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `function-test-report-${Date.now()}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            log('æµ‹è¯•æŠ¥å‘Šå·²å¯¼å‡º', 'success');
        }

        // 3Dæ¸²æŸ“æµ‹è¯•
        async function test3DRendering() {
            log('å¼€å§‹3Dæ¸²æŸ“åŠŸèƒ½æµ‹è¯•', 'info');
            const results = document.getElementById('rendering-results');
            results.innerHTML = '<div class="loading"></div>æ­£åœ¨æµ‹è¯•3Dæ¸²æŸ“...';

            const tests = [
                {
                    name: 'WebGLæ”¯æŒ',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                            return gl !== null;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'WebGL2æ”¯æŒ',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            return !!canvas.getContext('webgl2');
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'WebGLæ‰©å±•',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                            if (!gl) return false;
                            const extensions = gl.getSupportedExtensions();
                            return extensions && extensions.length > 0;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: '3Dæ•°å­¦åº“',
                    test: () => {
                        return typeof Math !== 'undefined' && 
                               typeof Math.sin !== 'undefined' &&
                               typeof Math.cos !== 'undefined' &&
                               typeof Math.PI !== 'undefined';
                    }
                }
            ];

            let passed = 0;
            let html = '';

            for (const test of tests) {
                const result = test.test();
                if (result) passed++;
                const status = result ? 'pass' : 'fail';
                const statusText = result ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
                
                html += `
                    <div class="test-item ${status}">
                        <span>${test.name}</span>
                        <span class="status ${status}">${statusText}</span>
                    </div>
                `;
                
                log(`${test.name}: ${statusText}`, result ? 'success' : 'error');
            }

            const percentage = Math.round((passed / tests.length) * 100);
            results.innerHTML = `
                <div class="summary-card" style="margin: 15px 0;">
                    <strong>3Dæ¸²æŸ“æ”¯æŒåº¦: ${percentage}% (${passed}/${tests.length})</strong>
                </div>
                ${html}
            `;

            // æ¨¡æ‹Ÿ3Dæ•ˆæœ
            simulate3DWeather();
            
            testResults.push({
                category: '3Dæ¸²æŸ“',
                passed: passed,
                total: tests.length,
                percentage: percentage
            });
        }

        // æ¨¡æ‹Ÿ3Då¤©æ°”æ•ˆæœ
        function simulate3DWeather() {
            const demo = document.getElementById('weather-demo');
            demo.innerHTML = '';
            
            // åˆ›å»ºå¤©æ°”åŠ¨ç”»
            const weatherType = Math.random() > 0.5 ? 'rain' : 'cloudy';
            
            if (weatherType === 'rain') {
                // é›¨æ»´åŠ¨ç”»
                for (let i = 0; i < 50; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.left = Math.random() * 100 + '%';
                    drop.style.animationDelay = Math.random() * 2 + 's';
                    drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                    demo.appendChild(drop);
                }
                demo.innerHTML += '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em;">ğŸŒ§ï¸</div>';
            } else {
                // äº‘æœµåŠ¨ç”»
                for (let i = 0; i < 5; i++) {
                    const cloud = document.createElement('div');
                    cloud.className = 'cloud';
                    cloud.style.top = Math.random() * 60 + '%';
                    cloud.style.animationDelay = Math.random() * 5 + 's';
                    cloud.style.animationDuration = (Math.random() * 10 + 10) + 's';
                    demo.appendChild(cloud);
                }
                demo.innerHTML += '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em;">â˜ï¸</div>';
            }
            
            log(`3Då¤©æ°”æ•ˆæœæ¨¡æ‹Ÿ: ${weatherType}`, 'success');
        }

        // å¤©æ°”ç‰¹æ•ˆæµ‹è¯•
        function testWeatherEffects() {
            log('å¼€å§‹å¤©æ°”ç‰¹æ•ˆæµ‹è¯•', 'info');
            const effects = ['sunny', 'rainy', 'cloudy', 'snowy', 'stormy'];
            const demo = document.getElementById('weather-demo');
            
            let currentIndex = 0;
            const interval = setInterval(() => {
                if (currentIndex >= effects.length) {
                    clearInterval(interval);
                    log('å¤©æ°”ç‰¹æ•ˆæµ‹è¯•å®Œæˆ', 'success');
                    return;
                }
                
                const effect = effects[currentIndex];
                demo.innerHTML = `<div style="font-size: 3em;">${getWeatherEmoji(effect)}</div>`;
                log(`æµ‹è¯•å¤©æ°”æ•ˆæœ: ${effect}`, 'info');
                currentIndex++;
            }, 1000);
        }

        function getWeatherEmoji(weather) {
            const emojiMap = {
                'sunny': 'â˜€ï¸',
                'rainy': 'ğŸŒ§ï¸',
                'cloudy': 'â˜ï¸',
                'snowy': 'â„ï¸',
                'stormy': 'â›ˆï¸'
            };
            return emojiMap[weather] || 'ğŸŒ¤ï¸';
        }

        // å¤©æ°”APIæµ‹è¯•
        async function testWeatherAPI() {
            const location = document.getElementById('location-input').value || 'Beijing';
            log(`å¼€å§‹å¤©æ°”APIæµ‹è¯• - åŸå¸‚: ${location}`, 'info');
            
            const results = document.getElementById('api-results');
            const responseDiv = document.getElementById('api-response');
            results.innerHTML = '<div class="loading"></div>æ­£åœ¨æµ‹è¯•å¤©æ°”API...';
            
            try {
                const startTime = performance.now();
                const response = await fetch(`/api/weather?location=${encodeURIComponent(location)}`);
                const endTime = performance.now();
                const loadTime = (endTime - startTime).toFixed(2);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    results.innerHTML = `
                        <div class="test-item pass">
                            <span>APIå“åº”çŠ¶æ€</span>
                            <span class="status pass">æˆåŠŸ (${response.status})</span>
                        </div>
                        <div class="test-item pass">
                            <span>å“åº”æ—¶é—´</span>
                            <span class="status pass">${loadTime}ms</span>
                        </div>
                        <div class="test-item pass">
                            <span>æ•°æ®æ ¼å¼</span>
                            <span class="status pass">æœ‰æ•ˆJSON</span>
                        </div>
                    `;
                    
                    responseDiv.style.display = 'block';
                    responseDiv.innerHTML = `<strong>APIå“åº”æ•°æ®:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
                    
                    // éªŒè¯æ•°æ®ç»“æ„
                    validateWeatherData(data);
                    
                    log(`å¤©æ°”APIæµ‹è¯•æˆåŠŸ - å“åº”æ—¶é—´: ${loadTime}ms`, 'success');
                } else {
                    results.innerHTML = `
                        <div class="test-item fail">
                            <span>APIå“åº”çŠ¶æ€</span>
                            <span class="status fail">å¤±è´¥ (${response.status})</span>
                        </div>
                    `;
                    log(`å¤©æ°”APIæµ‹è¯•å¤±è´¥ - çŠ¶æ€ç : ${response.status}`, 'error');
                }
            } catch (error) {
                results.innerHTML = `
                    <div class="test-item fail">
                        <span>APIè¿æ¥</span>
                        <span class="status fail">é”™è¯¯: ${error.message}</span>
                    </div>
                `;
                log(`å¤©æ°”APIè¿æ¥é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function validateWeatherData(data) {
            const requiredFields = ['location', 'current', 'forecast'];
            const missingFields = [];
            
            requiredFields.forEach(field => {
                if (!data[field]) {
                    missingFields.push(field);
                }
            });
            
            if (missingFields.length === 0) {
                log('å¤©æ°”æ•°æ®ç»“æ„éªŒè¯é€šè¿‡', 'success');
            } else {
                log(`å¤©æ°”æ•°æ®ç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`, 'warning');
            }
        }

        // å¤šåŸå¸‚æµ‹è¯•
        async function testMultipleCities() {
            const cities = ['Beijing', 'Shanghai', 'Guangzhou', 'Shenzhen', 'Chengdu'];
            log('å¼€å§‹å¤šåŸå¸‚å¤©æ°”APIæµ‹è¯•', 'info');
            
            const results = document.getElementById('api-results');
            results.innerHTML = '<div class="loading"></div>æ­£åœ¨æµ‹è¯•å¤šä¸ªåŸå¸‚...</div>';
            
            let passed = 0;
            let html = '';

            for (const city of cities) {
                try {
                    const response = await fetch(`/api/weather?location=${encodeURIComponent(city)}`);
                    if (response.ok) {
                        passed++;
                        html += `
                            <div class="test-item pass">
                                <span>${city}</span>
                                <span class="status pass">æˆåŠŸ</span>
                            </div>
                        `;
                        log(`${city}: APIè°ƒç”¨æˆåŠŸ`, 'success');
                    } else {
                        html += `
                            <div class="test-item fail">
                                <span>${city}</span>
                                <span class="status fail">å¤±è´¥ (${response.status})</span>
                            </div>
                        `;
                        log(`${city}: APIè°ƒç”¨å¤±è´¥`, 'error');
                    }
                } catch (error) {
                    html += `
                        <div class="test-item fail">
                            <span>${city}</span>
                            <span class="status fail">é”™è¯¯</span>
                        </div>
                    `;
                    log(`${city}: APIè°ƒç”¨é”™è¯¯`, 'error');
                }
                
                // æ·»åŠ å»¶è¿Ÿé¿å…APIé™æµ
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            const percentage = Math.round((passed / cities.length) * 100);
            results.innerHTML = `
                <div class="summary-card" style="margin: 15px 0;">
                    <strong>å¤šåŸå¸‚APIæµ‹è¯•: ${percentage}% (${passed}/${cities.length})</strong>
                </div>
                ${html}
            `;
        }

        // UIç»„ä»¶æµ‹è¯•
        function testUIComponents() {
            log('å¼€å§‹UIç»„ä»¶æµ‹è¯•', 'info');
            const results = document.getElementById('ui-results');
            results.innerHTML = '<div class="loading"></div>æ­£åœ¨æµ‹è¯•UIç»„ä»¶...</div>';

            const tests = [
                {
                    name: 'å“åº”å¼å¸ƒå±€',
                    test: () => window.innerWidth > 0 && window.innerHeight > 0
                },
                {
                    name: 'å­—ä½“åŠ è½½',
                    test: () => document.fonts && document.fonts.ready
                },
                {
                    name: 'CSSåŠ¨ç”»æ”¯æŒ',
                    test: () => CSS.supports('animation', 'test 1s')
                },
                {
                    name: 'æ¸å˜èƒŒæ™¯',
                    test: () => CSS.supports('background', 'linear-gradient(red, blue)')
                }
            ];

            let passed = 0;
            let html = '';

            tests.forEach(test => {
                const result = test.test();
                if (result) passed++;
                const status = result ? 'pass' : 'fail';
                const statusText = result ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
                
                html += `
                    <div class="test-item ${status}">
                        <span>${test.name}</span>
                        <span class="status ${status}">${statusText}</span>
                    </div>
                `;
                
                log(`UIæµ‹è¯• - ${test.name}: ${statusText}`, result ? 'success' : 'error');
            });

            const percentage = Math.round((passed / tests.length) * 100);
            results.innerHTML = `
                <div class="summary-card" style="margin: 15px 0;">
                    <strong>UIç»„ä»¶æ”¯æŒåº¦: ${percentage}% (${passed}/${tests.length})</strong>
                </div>
                ${html}
            `;
        }

        // å“åº”å¼è®¾è®¡æµ‹è¯•
        function testResponsiveDesign() {
            log('å¼€å§‹å“åº”å¼è®¾è®¡æµ‹è¯•', 'info');
            const results = document.getElementById('ui-results');
            
            const viewport = window.innerWidth;
            const deviceType = viewport <= 768 ? 'ç§»åŠ¨ç«¯' : viewport <= 1024 ? 'å¹³æ¿' : 'æ¡Œé¢ç«¯';
            
            const tests = [
                {
                    name: 'è§†å£å®½åº¦',
                    value: `${viewport}px`,
                    status: viewport > 0 ? 'pass' : 'fail'
                },
                {
                    name: 'è®¾å¤‡ç±»å‹',
                    value: deviceType,
                    status: 'pass'
                },
                {
                    name: 'åª’ä½“æŸ¥è¯¢',
                    value: 'æ”¯æŒ',
                    status: typeof window.matchMedia !== 'undefined' ? 'pass' : 'fail'
                }
            ];

            let html = '';
            tests.forEach(test => {
                html += `
                    <div class="test-item ${test.status}">
                        <span>${test.name}</span>
                        <span class="status ${test.status}">${test.value}</span>
                    </div>
                `;
                log(`å“åº”å¼æµ‹è¯• - ${test.name}: ${test.value}`, test.status === 'pass' ? 'success' : 'error');
            });

            results.innerHTML += html;
        }

        // æ€§èƒ½æµ‹è¯•
        async function testPerformance() {
            log('å¼€å§‹æ€§èƒ½åŸºå‡†æµ‹è¯•', 'info');
            const results = document.getElementById('performance-results');
            results.innerHTML = '<div class="loading"></div>æ­£åœ¨æµ‹è¯•æ€§èƒ½...</div>';

            // æµ‹è¯•é¡µé¢åŠ è½½æ—¶é—´
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            
            // æµ‹è¯•å†…å­˜ä½¿ç”¨
            const memoryInfo = performance.memory;
            const memoryUsage = memoryInfo ? (memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2) : 'N/A';
            
            // æµ‹è¯•FPSï¼ˆç®€åŒ–ç‰ˆï¼‰
            let frameCount = 0;
            let lastTime = performance.now();
            
            const measureFPS = () => {
                frameCount++;
                const currentTime = performance.now();
                if (currentTime - lastTime >= 1000) {
                    const fps = frameCount;
                    frameCount = 0;
                    lastTime = currentTime;
                    return fps;
                }
                return null;
            };

            let fpsResults = [];
            const fpsTest = setInterval(() => {
                const fps = measureFPS();
                if (fps !== null) {
                    fpsResults.push(fps);
                    if (fpsResults.length >= 5) {
                        clearInterval(fpsTest);
                        const avgFPS = Math.round(fpsResults.reduce((a, b) => a + b) / fpsResults.length);
                        
                        results.innerHTML = `
                            <div class="test-item ${loadTime < 3000 ? 'pass' : 'warning'}">
                                <span>é¡µé¢åŠ è½½æ—¶é—´</span>
                                <span class="status ${loadTime < 3000 ? 'pass' : 'warning'}">${loadTime}ms</span>
                            </div>
                            <div class="test-item ${memoryUsage !== 'N/A' ? 'pass' : 'warning'}">
                                <span>å†…å­˜ä½¿ç”¨</span>
                                <span class="status ${memoryUsage !== 'N/A' ? 'pass' : 'warning'}">${memoryUsage} MB</span>
                            </div>
                            <div class="test-item ${avgFPS >= 30 ? 'pass' : 'warning'}">
                                <span>å¹³å‡å¸§ç‡</span>
                                <span class="status ${avgFPS >= 30 ? 'pass' : 'warning'}">${avgFPS} FPS</span>
                            </div>
                        `;
                        
                        log(`æ€§èƒ½æµ‹è¯•å®Œæˆ - åŠ è½½æ—¶é—´: ${loadTime}ms, å†…å­˜: ${memoryUsage}MB, FPS: ${avgFPS}`, 'success');
                        
                        performanceMetrics = {
                            loadTime: loadTime,
                            memoryUsage: memoryUsage,
                            avgFPS: avgFPS
                        };
                    }
                }
            }, 100);
        }

        // ç»¼åˆæµ‹è¯•
        async function runAllFunctionTests() {
            log('å¼€å§‹å…¨é¢åŠŸèƒ½æµ‹è¯•', 'info');
            testResults = [];
            
            // æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
            await test3DRendering();
            await testWeatherAPI();
            testUIComponents();
            testResponsiveDesign();
            await testPerformance();
            
            // ç”Ÿæˆç»¼åˆæŠ¥å‘Š
            generateOverallReport();
            log('å…¨é¢åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
        }

        // ç”Ÿæˆç»¼åˆæŠ¥å‘Š
        function generateOverallReport() {
            const totalTests = testResults.reduce((sum, result) => sum + result.total, 0);
            const totalPassed = testResults.reduce((sum, result) => sum + result.passed, 0);
            const overallPercentage = Math.round((totalPassed / totalTests) * 100);
            
            document.getElementById('overall-score').textContent = overallPercentage + '%';
            document.getElementById('overall-progress').style.width = overallPercentage + '%';
            
            let summary = '';
            if (overallPercentage >= 90) {
                summary = 'ğŸ‰ ä¼˜ç§€ - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ';
            } else if (overallPercentage >= 80) {
                summary = 'âœ… è‰¯å¥½ - å¤§éƒ¨åˆ†åŠŸèƒ½æ­£å¸¸';
            } else if (overallPercentage >= 70) {
                summary = 'âš ï¸ ä¸€èˆ¬ - éƒ¨åˆ†åŠŸèƒ½éœ€è¦ä¼˜åŒ–';
            } else {
                summary = 'âŒ éœ€è¦æ”¹è¿› - å¤šé¡¹åŠŸèƒ½å¼‚å¸¸';
            }
            
            document.getElementById('test-summary').innerHTML = `
                <div style="font-size: 1.2em; margin: 10px 0;">${summary}</div>
                <div>æ€»æµ‹è¯•æ•°: ${totalTests} | é€šè¿‡: ${totalPassed} | å¤±è´¥: ${totalTests - totalPassed}</div>
                ${performanceMetrics.loadTime ? `<div>å¹³å‡åŠ è½½æ—¶é—´: ${performanceMetrics.loadTime}ms</div>` : ''}
                ${performanceMetrics.avgFPS ? `<div>å¹³å‡å¸§ç‡: ${performanceMetrics.avgFPS} FPS</div>` : ''}
            `;
            
            log(`ç»¼åˆæµ‹è¯•æŠ¥å‘Š - é€šè¿‡ç‡: ${overallPercentage}% (${totalPassed}/${totalTests})`, 
                overallPercentage >= 80 ? 'success' : overallPercentage >= 60 ? 'warning' : 'error');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            log('åŠŸèƒ½æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'info');
            // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
            setTimeout(() => {
                test3DRendering();
            }, 1000);
        });
    </script>
</body>
</html>