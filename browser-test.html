<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Då¤©æ°”åº”ç”¨ - è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #333; 
            min-height: 100vh; 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            backdrop-filter: blur(10px); 
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
        }
        .header h1 { 
            color: #2c3e50; 
            margin-bottom: 10px; 
            font-size: 2.5em; 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        .browser-info { 
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            font-weight: bold; 
        }
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 25px; 
            margin: 30px 0; 
        }
        .test-section { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
            border: 1px solid #e9ecef; 
            transition: transform 0.3s ease; 
        }
        .test-section:hover { 
            transform: translateY(-5px); 
        }
        .test-section h3 { 
            color: #495057; 
            margin-bottom: 20px; 
            font-size: 1.3em; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .test-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 15px; 
            margin: 8px 0; 
            background: #f8f9fa; 
            border-radius: 8px; 
            border-left: 4px solid #e9ecef; 
            transition: all 0.3s ease; 
        }
        .test-item:hover { 
            background: #e9ecef; 
            transform: translateX(5px); 
        }
        .test-item.pass { 
            border-left-color: #28a745; 
            background: #d4edda; 
        }
        .test-item.fail { 
            border-left-color: #dc3545; 
            background: #f8d7da; 
        }
        .test-item.warning { 
            border-left-color: #ffc107; 
            background: #fff3cd; 
        }
        .status { 
            font-weight: bold; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 0.9em; 
        }
        .status.pass { color: #28a745; background: #d4edda; }
        .status.fail { color: #dc3545; background: #f8d7da; }
        .status.warning { color: #856404; background: #fff3cd; }
        .status.info { color: #0c5460; background: #d1ecf1; }
        button { 
            padding: 12px 20px; 
            margin: 8px 5px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            font-size: 14px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .btn-primary { 
            background: linear-gradient(45deg, #007bff, #0056b3); 
            color: white; 
            box-shadow: 0 4px 15px rgba(0,123,255,0.3); 
        }
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(0,123,255,0.4); 
        }
        .btn-secondary { 
            background: linear-gradient(45deg, #6c757d, #545b62); 
            color: white; 
        }
        .btn-success { 
            background: linear-gradient(45deg, #28a745, #1e7e34); 
            color: white; 
        }
        .btn-warning { 
            background: linear-gradient(45deg, #ffc107, #e0a800); 
            color: #212529; 
        }
        .progress-bar { 
            width: 100%; 
            height: 8px; 
            background: #e9ecef; 
            border-radius: 4px; 
            overflow: hidden; 
            margin: 15px 0; 
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(45deg, #28a745, #20c997); 
            transition: width 0.3s ease; 
        }
        .summary-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 25px; 
            border-radius: 15px; 
            margin: 20px 0; 
            text-align: center; 
        }
        .summary-card h3 { 
            margin-bottom: 15px; 
            font-size: 1.5em; 
        }
        .compatibility-score { 
            font-size: 3em; 
            font-weight: bold; 
            margin: 10px 0; 
        }
        .feature-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .feature-item { 
            padding: 15px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 10px; 
            text-align: center; 
            border: 1px solid rgba(255,255,255,0.2); 
        }
        .threejs-demo { 
            width: 100%; 
            height: 200px; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            margin: 15px 0; 
            background: #f8f9fa; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.2em; 
            color: #6c757d; 
        }
        .loading { 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #007bff; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-right: 10px; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .collapsible { 
            background: white; 
            border: 1px solid #e9ecef; 
            border-radius: 8px; 
            margin: 10px 0; 
            overflow: hidden; 
        }
        .collapsible-header { 
            padding: 15px; 
            background: #f8f9fa; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            transition: background 0.3s ease; 
        }
        .collapsible-header:hover { 
            background: #e9ecef; 
        }
        .collapsible-content { 
            padding: 0 15px; 
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.3s ease, padding 0.3s ease; 
        }
        .collapsible-content.active { 
            max-height: 500px; 
            padding: 15px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ 3Då¤©æ°”åº”ç”¨ - è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h1>
            <p>å…¨é¢æµ‹è¯•åº”ç”¨åœ¨å„ç§æµè§ˆå™¨å’Œè®¾å¤‡ä¸Šçš„å…¼å®¹æ€§è¡¨ç°</p>
        </div>

        <div class="browser-info" id="browser-info">
            <div class="loading"></div>
            æ­£åœ¨æ£€æµ‹æµè§ˆå™¨ä¿¡æ¯...
        </div>

        <div class="test-grid">
            <!-- æµè§ˆå™¨å¼•æ“æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ”§ æµè§ˆå™¨å¼•æ“æ£€æµ‹</h3>
                <div id="engine-tests"></div>
                <button class="btn-primary" onclick="testBrowserEngine()">é‡æ–°æµ‹è¯•å¼•æ“</button>
            </div>

            <!-- WebGLå…¼å®¹æ€§ -->
            <div class="test-section">
                <h3>ğŸ® WebGLå…¼å®¹æ€§æµ‹è¯•</h3>
                <div id="webgl-tests"></div>
                <div class="threejs-demo" id="threejs-demo">
                    <div class="loading"></div>
                    æ­£åœ¨åŠ è½½3Dæ¼”ç¤º...
                </div>
                <button class="btn-primary" onclick="testWebGL()">æµ‹è¯•WebGL</button>
                <button class="btn-secondary" onclick="testThreeJS()">æµ‹è¯•Three.js</button>
            </div>

            <!-- ç°ä»£Web API -->
            <div class="test-section">
                <h3>âš¡ ç°ä»£Web APIæ”¯æŒ</h3>
                <div id="api-tests"></div>
                <button class="btn-primary" onclick="testModernAPIs()">æµ‹è¯•APIæ”¯æŒ</button>
            </div>

            <!-- CSSç‰¹æ€§ -->
            <div class="test-section">
                <h3>ğŸ¨ CSSç‰¹æ€§æ”¯æŒ</h3>
                <div id="css-tests"></div>
                <button class="btn-primary" onclick="testCSSFeatures()">æµ‹è¯•CSSç‰¹æ€§</button>
            </div>

            <!-- JavaScript ES6+ -->
            <div class="test-section">
                <h3>ğŸ“œ JavaScript ES6+ç‰¹æ€§</h3>
                <div id="js-tests"></div>
                <button class="btn-primary" onclick="testJavaScriptFeatures()">æµ‹è¯•JSç‰¹æ€§</button>
            </div>

            <!-- ç§»åŠ¨ç«¯å…¼å®¹æ€§ -->
            <div class="test-section">
                <h3>ğŸ“± ç§»åŠ¨ç«¯å…¼å®¹æ€§</h3>
                <div id="mobile-tests"></div>
                <button class="btn-primary" onclick="testMobileFeatures()">æµ‹è¯•ç§»åŠ¨ç«¯</button>
            </div>

            <!-- æ€§èƒ½æµ‹è¯• -->
            <div class="test-section">
                <h3>âš™ï¸ æ€§èƒ½åŸºå‡†æµ‹è¯•</h3>
                <div id="performance-tests"></div>
                <button class="btn-primary" onclick="testPerformance()">æ€§èƒ½æµ‹è¯•</button>
                <button class="btn-warning" onclick="testMemoryUsage()">å†…å­˜æµ‹è¯•</button>
            </div>

            <!-- ç½‘ç»œå…¼å®¹æ€§ -->
            <div class="test-section">
                <h3>ğŸŒ ç½‘ç»œåè®®æ”¯æŒ</h3>
                <div id="network-tests"></div>
                <button class="btn-primary" onclick="testNetworkFeatures()">ç½‘ç»œæµ‹è¯•</button>
            </div>
        </div>

        <!-- ç»¼åˆæŠ¥å‘Š -->
        <div class="summary-card">
            <h3>ğŸ“Š å…¼å®¹æ€§ç»¼åˆè¯„åˆ†</h3>
            <div class="compatibility-score" id="compatibility-score">--</div>
            <div class="progress-bar">
                <div class="progress-fill" id="compatibility-progress"></div>
            </div>
            <div id="compatibility-summary"></div>
        </div>

        <!-- è¯¦ç»†æŠ¥å‘Š -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible('detailed-report')">
                <span>ğŸ“‹ è¯¦ç»†æµ‹è¯•æŠ¥å‘Š</span>
                <span>â–¼</span>
            </div>
            <div class="collapsible-content" id="detailed-report">
                <div id="detailed-results"></div>
            </div>
        </div>

        <!-- å»ºè®®å’Œæ”¹è¿› -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible('suggestions')">
                <span>ğŸ’¡ å…¼å®¹æ€§å»ºè®®</span>
                <span>â–¼</span>
            </div>
            <div class="collapsible-content" id="suggestions">
                <div id="compatibility-suggestions"></div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn-success" onclick="runAllCompatibilityTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn-secondary" onclick="exportReport()">ğŸ“¤ å¯¼å‡ºæŠ¥å‘Š</button>
            <button class="btn-warning" onclick="location.reload()">ğŸ”„ é‡æ–°åŠ è½½</button>
        </div>
    </div>

    <script>
        // å…¨å±€æµ‹è¯•ç»“æœå­˜å‚¨
        let compatibilityResults = [];
        let browserInfo = {};

        // è·å–æµè§ˆå™¨ä¿¡æ¯
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            const info = {
                userAgent: ua,
                browser: 'Unknown',
                version: 'Unknown',
                engine: 'Unknown',
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                deviceMemory: navigator.deviceMemory || 'Unknown'
            };

            // æ£€æµ‹æµè§ˆå™¨ç±»å‹
            if (ua.includes('Chrome') && !ua.includes('Edg')) {
                info.browser = 'Chrome';
                info.version = ua.match(/Chrome\/(\d+)/)?.[1] || 'Unknown';
                info.engine = 'Blink';
            } else if (ua.includes('Firefox')) {
                info.browser = 'Firefox';
                info.version = ua.match(/Firefox\/(\d+)/)?.[1] || 'Unknown';
                info.engine = 'Gecko';
            } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                info.browser = 'Safari';
                info.version = ua.match(/Version\/(\d+)/)?.[1] || 'Unknown';
                info.engine = 'WebKit';
            } else if (ua.includes('Edg')) {
                info.browser = 'Edge';
                info.version = ua.match(/Edg\/(\d+)/)?.[1] || 'Unknown';
                info.engine = 'Blink';
            } else if (ua.includes('Trident') || ua.includes('MSIE')) {
                info.browser = 'Internet Explorer';
                info.version = ua.match(/(?:MSIE |rv:)(\d+)/)?.[1] || 'Unknown';
                info.engine = 'Trident';
            }

            browserInfo = info;
            return info;
        }

        // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        function displayBrowserInfo() {
            const info = getBrowserInfo();
            const browserInfoDiv = document.getElementById('browser-info');
            
            browserInfoDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="feature-item">
                        <strong>ğŸŒ æµè§ˆå™¨</strong><br>
                        ${info.browser} ${info.version}
                    </div>
                    <div class="feature-item">
                        <strong>âš™ï¸ å¼•æ“</strong><br>
                        ${info.engine}
                    </div>
                    <div class="feature-item">
                        <strong>ğŸ’» å¹³å°</strong><br>
                        ${info.platform}
                    </div>
                    <div class="feature-item">
                        <strong>ğŸŒ è¯­è¨€</strong><br>
                        ${info.language}
                    </div>
                    <div class="feature-item">
                        <strong>ğŸª Cookie</strong><br>
                        ${info.cookieEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}
                    </div>
                    <div class="feature-item">
                        <strong>ğŸ“¡ åœ¨çº¿</strong><br>
                        ${info.onLine ? 'æ˜¯' : 'å¦'}
                    </div>
                </div>
            `;
        }

        // æµè§ˆå™¨å¼•æ“æµ‹è¯•
        function testBrowserEngine() {
            const tests = [
                {
                    name: 'Blinkå¼•æ“ (Chrome/Edge)',
                    test: () => navigator.userAgent.includes('Chrome') && !navigator.userAgent.includes('Edg') ? 'pass' : 
                           navigator.userAgent.includes('Edg') ? 'pass' : 'fail'
                },
                {
                    name: 'WebKitå¼•æ“ (Safari)',
                    test: () => navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome') ? 'pass' : 'fail'
                },
                {
                    name: 'Geckoå¼•æ“ (Firefox)',
                    test: () => navigator.userAgent.includes('Firefox') ? 'pass' : 'fail'
                },
                {
                    name: 'Tridentå¼•æ“ (IE)',
                    test: () => navigator.userAgent.includes('Trident') || navigator.userAgent.includes('MSIE') ? 'pass' : 'fail'
                }
            ];

            return runTests('engine-tests', tests, 'å¼•æ“æ£€æµ‹');
        }

        // WebGLå…¼å®¹æ€§æµ‹è¯•
        function testWebGL() {
            const tests = [
                {
                    name: 'WebGLæ”¯æŒ',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'WebGL2æ”¯æŒ',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            return !!canvas.getContext('webgl2');
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'WebGLä¸Šä¸‹æ–‡åˆ›å»º',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                            return gl !== null;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'WebGLæ‰©å±•æ”¯æŒ',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                            if (!gl) return false;
                            const extensions = gl.getSupportedExtensions();
                            return extensions && extensions.length > 0;
                        } catch (e) {
                            return false;
                        }
                    }
                }
            ];

            return runTests('webgl-tests', tests, 'WebGLå…¼å®¹æ€§');
        }

        // Three.jsæµ‹è¯•
        function testThreeJS() {
            const demoDiv = document.getElementById('threejs-demo');
            demoDiv.innerHTML = '<div class="loading"></div>æ­£åœ¨åŠ è½½Three.jsæ¼”ç¤º...';
            
            // æ¨¡æ‹ŸThree.jsåŠŸèƒ½æµ‹è¯•
            const tests = [
                {
                    name: 'Three.jsæ ¸å¿ƒåŠŸèƒ½',
                    test: () => {
                        // æ¨¡æ‹ŸThree.jsç¯å¢ƒæ£€æµ‹
                        return typeof window !== 'undefined' && 
                               typeof document !== 'undefined' &&
                               typeof requestAnimationFrame !== 'undefined';
                    }
                },
                {
                    name: '3Dæ•°å­¦åº“æ”¯æŒ',
                    test: () => {
                        return typeof Math !== 'undefined' && 
                               typeof Math.PI !== 'undefined' &&
                               typeof Math.sin !== 'undefined';
                    }
                },
                {
                    name: 'åŠ¨ç”»å¸§æ”¯æŒ',
                    test: () => {
                        return typeof requestAnimationFrame !== 'undefined' &&
                               typeof cancelAnimationFrame !== 'undefined';
                    }
                }
            ];

            setTimeout(() => {
                demoDiv.innerHTML = 'ğŸ® Three.jsæ¼”ç¤ºåŒºåŸŸ<br><small>ï¼ˆéœ€è¦å®é™…Three.jsåº“è¿›è¡Œå®Œæ•´æµ‹è¯•ï¼‰</small>';
            }, 2000);

            return runTests('webgl-tests', tests, 'Three.jsæ”¯æŒ', true);
        }

        // ç°ä»£Web APIæµ‹è¯•
        function testModernAPIs() {
            const tests = [
                {
                    name: 'Fetch API',
                    test: () => typeof fetch !== 'undefined'
                },
                {
                    name: 'Promiseæ”¯æŒ',
                    test: () => typeof Promise !== 'undefined'
                },
                {
                    name: 'Async/Await',
                    test: () => {
                        try {
                            eval('async function test() { await 1; }');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'Geolocation API',
                    test: () => 'geolocation' in navigator
                },
                {
                    name: 'LocalStorage',
                    test: () => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'Service Worker',
                    test: () => 'serviceWorker' in navigator
                },
                {
                    name: 'Intersection Observer',
                    test: () => 'IntersectionObserver' in window
                },
                {
                    name: 'Resize Observer',
                    test: () => 'ResizeObserver' in window
                }
            ];

            return runTests('api-tests', tests, 'Web APIæ”¯æŒ');
        }

        // CSSç‰¹æ€§æµ‹è¯•
        function testCSSFeatures() {
            const tests = [
                {
                    name: 'CSS Grid',
                    test: () => CSS.supports('display', 'grid')
                },
                {
                    name: 'CSS Flexbox',
                    test: () => CSS.supports('display', 'flex')
                },
                {
                    name: 'CSS Variables',
                    test: () => CSS.supports('--test', '0')
                },
                {
                    name: 'CSS Transforms',
                    test: () => CSS.supports('transform', 'translateX(0)')
                },
                {
                    name: 'CSS Transitions',
                    test: () => CSS.supports('transition', 'all 0.3s')
                },
                {
                    name: 'CSS Animations',
                    test: () => CSS.supports('animation', 'test 1s')
                },
                {
                    name: 'CSS Gradients',
                    test: () => CSS.supports('background', 'linear-gradient(red, blue)')
                },
                {
                    name: 'CSS Backdrop Filter',
                    test: () => CSS.supports('backdrop-filter', 'blur(10px)')
                }
            ];

            return runTests('css-tests', tests, 'CSSç‰¹æ€§æ”¯æŒ');
        }

        // JavaScriptç‰¹æ€§æµ‹è¯•
        function testJavaScriptFeatures() {
            const tests = [
                {
                    name: 'ES6ç®­å¤´å‡½æ•°',
                    test: () => {
                        try {
                            eval('() => {}');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6è§£æ„èµ‹å€¼',
                    test: () => {
                        try {
                            eval('const [a] = [1]');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6æ¨¡æ¿å­—ç¬¦ä¸²',
                    test: () => {
                        try {
                            eval('`test`');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6ç±»',
                    test: () => {
                        try {
                            eval('class Test {}');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6æ¨¡å—',
                    test: () => {
                        const script = document.createElement('script');
                        return 'noModule' in script;
                    }
                },
                {
                    name: 'ES8 Async/Await',
                    test: () => {
                        try {
                            eval('async function test() { await 1; }');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                }
            ];

            return runTests('js-tests', tests, 'JavaScriptç‰¹æ€§');
        }

        // ç§»åŠ¨ç«¯ç‰¹æ€§æµ‹è¯•
        function testMobileFeatures() {
            const tests = [
                {
                    name: 'è§¦æ‘¸äº‹ä»¶',
                    test: () => 'ontouchstart' in window
                },
                {
                    name: 'è®¾å¤‡æ–¹å‘',
                    test: () => 'DeviceOrientationEvent' in window
                },
                {
                    name: 'è®¾å¤‡è¿åŠ¨',
                    test: () => 'DeviceMotionEvent' in window
                },
                {
                    name: 'æŒ¯åŠ¨API',
                    test: () => 'vibrate' in navigator
                },
                {
                    name: 'å…¨å±API',
                    test: () => 'requestFullscreen' in document.documentElement
                },
                {
                    name: 'å±å¹•æ–¹å‘',
                    test: () => 'orientation' in screen
                },
                {
                    name: 'åª’ä½“æŸ¥è¯¢',
                    test: () => typeof window.matchMedia !== 'undefined'
                },
                {
                    name: 'è§†å£å•ä½',
                    test: () => CSS.supports('width', '100vw')
                }
            ];

            return runTests('mobile-tests', tests, 'ç§»åŠ¨ç«¯ç‰¹æ€§');
        }

        // æ€§èƒ½æµ‹è¯•
        function testPerformance() {
            const tests = [
                {
                    name: 'Performance API',
                    test: () => 'performance' in window
                },
                {
                    name: 'Performance Observer',
                    test: () => 'PerformanceObserver' in window
                },
                {
                    name: 'Navigation Timing',
                    test: () => 'timing' in performance
                },
                {
                    name: 'User Timing',
                    test: () => 'mark' in performance
                },
                {
                    name: 'Resource Timing',
                    test: () => 'getEntriesByType' in performance
                },
                {
                    name: 'Memory Info',
                    test: () => 'memory' in performance
                }
            ];

            return runTests('performance-tests', tests, 'æ€§èƒ½APIæ”¯æŒ');
        }

        // å†…å­˜ä½¿ç”¨æµ‹è¯•
        function testMemoryUsage() {
            const memoryInfo = performance.memory;
            const results = document.getElementById('performance-tests');
            
            if (memoryInfo) {
                const html = `
                    <div class="test-item pass">
                        <span>å†…å­˜ä½¿ç”¨ä¿¡æ¯</span>
                        <span class="status pass">å¯ç”¨</span>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>å†…å­˜ç»Ÿè®¡:</strong><br>
                        å·²ç”¨å†…å­˜: ${(memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB<br>
                        æ€»å†…å­˜: ${(memoryInfo.totalJSHeapSize / 1024 / 1024).toFixed(2)} MB<br>
                        å†…å­˜é™åˆ¶: ${(memoryInfo.jsHeapSizeLimit / 1024 / 1024).toFixed(2)} MB<br>
                        ä½¿ç”¨ç‡: ${((memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit) * 100).toFixed(1)}%
                    </div>
                `;
                results.innerHTML += html;
            } else {
                results.innerHTML += `
                    <div class="test-item warning">
                        <span>å†…å­˜ä½¿ç”¨ä¿¡æ¯</span>
                        <span class="status warning">ä¸å¯ç”¨</span>
                    </div>
                `;
            }
        }

        // ç½‘ç»œç‰¹æ€§æµ‹è¯•
        function testNetworkFeatures() {
            const tests = [
                {
                    name: 'HTTP/2æ”¯æŒ',
                    test: () => 'connection' in navigator && navigator.connection.effectiveType !== undefined
                },
                {
                    name: 'ç½‘ç»œè¿æ¥API',
                    test: () => 'connection' in navigator
                },
                {
                    name: 'ç½‘ç»œç±»å‹',
                    test: () => {
                        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                        return connection && connection.effectiveType !== undefined;
                    }
                },
                {
                    name: 'Beacon API',
                    test: () => 'sendBeacon' in navigator
                },
                {
                    name: 'WebSocket',
                    test: () => 'WebSocket' in window
                },
                {
                    name: 'XMLHttpRequest',
                    test: () => 'XMLHttpRequest' in window
                }
            ];

            return runTests('network-tests', tests, 'ç½‘ç»œåè®®æ”¯æŒ');
        }

        // é€šç”¨æµ‹è¯•è¿è¡Œå‡½æ•°
        function runTests(containerId, tests, category, append = false) {
            const container = document.getElementById(containerId);
            if (!append) {
                container.innerHTML = '<div class="loading"></div>æ­£åœ¨æµ‹è¯•...';
            }

            setTimeout(() => {
                let html = '';
                let passed = 0;
                let total = tests.length;

                tests.forEach(test => {
                    let result;
                    try {
                        result = test.test();
                    } catch (e) {
                        result = false;
                    }

                    const status = result === 'pass' || result === true ? 'pass' : 'fail';
                    const statusText = result === 'pass' || result === true ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';

                    if (status === 'pass') passed++;

                    html += `
                        <div class="test-item ${status}">
                            <span>${test.name}</span>
                            <span class="status ${status}">${statusText}</span>
                        </div>
                    `;

                    // å­˜å‚¨ç»“æœ
                    compatibilityResults.push({
                        category: category,
                        test: test.name,
                        result: status,
                        passed: status === 'pass'
                    });
                });

                const percentage = Math.round((passed / total) * 100);
                const summary = `
                    <div style="background: ${percentage >= 80 ? '#d4edda' : percentage >= 60 ? '#fff3cd' : '#f8d7da'}; 
                                padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <strong>${category}:</strong> ${passed}/${total} (${percentage}%) æ”¯æŒ
                    </div>
                `;

                if (append) {
                    container.innerHTML += html;
                } else {
                    container.innerHTML = summary + html;
                }

                updateCompatibilityScore();
            }, 1000);

            return { passed, total };
        }

        // æ›´æ–°å…¼å®¹æ€§è¯„åˆ†
        function updateCompatibilityScore() {
            const passed = compatibilityResults.filter(r => r.passed).length;
            const total = compatibilityResults.length;
            const score = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('compatibility-score').textContent = score + '%';
            document.getElementById('compatibility-progress').style.width = score + '%';

            let summary = '';
            if (score >= 90) {
                summary = 'ğŸ‰ ä¼˜ç§€å…¼å®¹æ€§ - å®Œå…¨æ”¯æŒæ‰€æœ‰åŠŸèƒ½';
            } else if (score >= 80) {
                summary = 'âœ… è‰¯å¥½å…¼å®¹æ€§ - å¤§éƒ¨åˆ†åŠŸèƒ½å¯ç”¨';
            } else if (score >= 70) {
                summary = 'âš ï¸ ä¸€èˆ¬å…¼å®¹æ€§ - éƒ¨åˆ†åŠŸèƒ½å—é™';
            } else if (score >= 50) {
                summary = 'âŒ è¾ƒå·®å…¼å®¹æ€§ - éœ€è¦é™çº§å¤„ç†';
            } else {
                summary = 'ğŸš¨ ä¸¥é‡å…¼å®¹æ€§ - ä¸å»ºè®®ä½¿ç”¨';
            }

            document.getElementById('compatibility-summary').innerHTML = `
                <div style="font-size: 1.2em; margin: 10px 0;">${summary}</div>
                <div>æµ‹è¯•é¡¹ç›®: ${total} | é€šè¿‡: ${passed} | å¤±è´¥: ${total - passed}</div>
            `;
        }

        // è¿è¡Œæ‰€æœ‰å…¼å®¹æ€§æµ‹è¯•
        function runAllCompatibilityTests() {
            compatibilityResults = [];
            
            displayBrowserInfo();
            testBrowserEngine();
            testWebGL();
            testThreeJS();
            testModernAPIs();
            testCSSFeatures();
            testJavaScriptFeatures();
            testMobileFeatures();
            testPerformance();
            testNetworkFeatures();

            // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
            setTimeout(() => {
                generateDetailedReport();
                generateSuggestions();
            }, 3000);
        }

        // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
        function generateDetailedReport() {
            const categories = {};
            compatibilityResults.forEach(result => {
                if (!categories[result.category]) {
                    categories[result.category] = { passed: 0, total: 0 };
                }
                categories[result.category].total++;
                if (result.passed) {
                    categories[result.category].passed++;
                }
            });

            let html = '<div class="feature-grid">';
            Object.entries(categories).forEach(([category, stats]) => {
                const percentage = Math.round((stats.passed / stats.total) * 100);
                const color = percentage >= 80 ? '#28a745' : percentage >= 60 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div class="feature-item" style="background: ${color}; color: white;">
                        <strong>${category}</strong><br>
                        ${stats.passed}/${stats.total}<br>
                        <small>${percentage}%</small>
                    </div>
                `;
            });
            html += '</div>';

            document.getElementById('detailed-results').innerHTML = html;
        }

        // ç”Ÿæˆå»ºè®®
        function generateSuggestions() {
            const suggestions = [];
            const browser = browserInfo.browser;
            const score = parseInt(document.getElementById('compatibility-score').textContent);

            // åŸºäºæµè§ˆå™¨ç±»å‹çš„å»ºè®®
            if (browser === 'Internet Explorer') {
                suggestions.push('ğŸš¨ å¼ºçƒˆå»ºè®®å‡çº§åˆ°ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariæˆ–Edgeï¼‰');
            } else if (browser === 'Safari') {
                suggestions.push('âš ï¸ Safariå¯¹æŸäº›WebGLæ‰©å±•æ”¯æŒæœ‰é™ï¼Œå»ºè®®è¿›è¡Œé¢å¤–æµ‹è¯•');
            }

            // åŸºäºè¯„åˆ†çš„å»ºè®®
            if (score < 50) {
                suggestions.push('ğŸš¨ å½“å‰æµè§ˆå™¨å…¼å®¹æ€§è¾ƒå·®ï¼Œå»ºè®®å‡çº§æˆ–æ›´æ¢æµè§ˆå™¨');
                suggestions.push('ğŸ“± è€ƒè™‘ä½¿ç”¨ç§»åŠ¨ç«¯æµè§ˆå™¨è®¿é—®');
            } else if (score < 70) {
                suggestions.push('âš ï¸ éƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œå»ºè®®å¯ç”¨é™çº§æ–¹æ¡ˆ');
                suggestions.push('ğŸ”§ æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ï¼Œç¡®ä¿WebGLå’Œç›¸å…³åŠŸèƒ½å·²å¯ç”¨');
            } else if (score < 90) {
                suggestions.push('âœ… å¤§éƒ¨åˆ†åŠŸèƒ½å¯ç”¨ï¼Œä½†å»ºè®®è¿›è¡Œé¢å¤–ä¼˜åŒ–');
                suggestions.push('ğŸ¨ è€ƒè™‘æ·»åŠ CSSå‰ç¼€ä»¥ç¡®ä¿æ›´å¥½çš„å…¼å®¹æ€§');
            } else {
                suggestions.push('ğŸ‰ ä¼˜ç§€çš„å…¼å®¹æ€§ï¼å¯ä»¥å¯ç”¨æ‰€æœ‰é«˜çº§åŠŸèƒ½');
                suggestions.push('âš¡ å¯ä»¥å®‰å…¨ä½¿ç”¨æœ€æ–°çš„WebæŠ€æœ¯å’ŒAPI');
            }

            // é€šç”¨å»ºè®®
            suggestions.push('ğŸ“Š å®šæœŸæ›´æ–°æµè§ˆå™¨ä»¥è·å¾—æœ€ä½³ä½“éªŒ');
            suggestions.push('ğŸ”’ ç¡®ä¿æµè§ˆå™¨å®‰å…¨è®¾ç½®ä¸ä¼šé˜»æ­¢å¿…è¦åŠŸèƒ½');
            suggestions.push('ğŸŒ åœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹æµ‹è¯•åº”ç”¨æ€§èƒ½');

            document.getElementById('compatibility-suggestions').innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4>ğŸ’¡ æ”¹è¿›å»ºè®®</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${suggestions.map(s => `<li style="margin: 8px 0;">${s}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // åˆ‡æ¢æŠ˜å å†…å®¹
        function toggleCollapsible(id) {
            const content = document.getElementById(id);
            const header = content.previousElementSibling;
            const arrow = header.querySelector('span:last-child');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = 'â–¼';
            } else {
                content.classList.add('active');
                arrow.textContent = 'â–²';
            }
        }

        // å¯¼å‡ºæŠ¥å‘Š
        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                browserInfo: browserInfo,
                compatibilityScore: document.getElementById('compatibility-score').textContent,
                results: compatibilityResults,
                userAgent: navigator.userAgent,
                url: window.location.href
            };

            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `compatibility-report-${Date.now()}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            displayBrowserInfo();
            setTimeout(() => {
                runAllCompatibilityTests();
            }, 1000);
        });
    </script>
</body>
</html>