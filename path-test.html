<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Då¤©æ°”åº”ç”¨ - è·¯å¾„æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 15px; 
            backdrop-filter: blur(10px); 
        }
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .test-card { 
            padding: 20px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 10px; 
            border: 1px solid rgba(255,255,255,0.2); 
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            background: linear-gradient(45deg, #007bff, #0056b3); 
            color: white; 
            transition: all 0.3s ease; 
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 15px rgba(0,123,255,0.3); 
        }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 5px; 
            border-left: 4px solid #007bff; 
        }
        pre { 
            background: rgba(0,0,0,0.2); 
            padding: 10px; 
            border-radius: 5px; 
            overflow-x: auto; 
            font-size: 12px; 
        }
        .path-test { 
            font-family: monospace; 
            background: rgba(0,0,0,0.3); 
            padding: 2px 4px; 
            border-radius: 3px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— 3Då¤©æ°”åº”ç”¨ - è·¯å¾„å…¼å®¹æ€§æµ‹è¯•</h1>
        <p>æµ‹è¯•æ‰€æœ‰èµ„æºè·¯å¾„åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æ­£ç¡®æ€§</p>
        
        <div class="test-grid">
            <div class="test-card">
                <h3>ğŸ“ é™æ€èµ„æºæµ‹è¯•</h3>
                <button onclick="testStaticResources()">æµ‹è¯•é™æ€èµ„æº</button>
                <button onclick="testTextures()">æµ‹è¯•çº¹ç†æ–‡ä»¶</button>
                <div id="static-results"></div>
            </div>
            
            <div class="test-card">
                <h3>ğŸŒ ç›¸å¯¹è·¯å¾„æµ‹è¯•</h3>
                <button onclick="testRelativePaths()">æµ‹è¯•ç›¸å¯¹è·¯å¾„</button>
                <button onclick="testAbsolutePaths()">æµ‹è¯•ç»å¯¹è·¯å¾„</button>
                <div id="path-results"></div>
            </div>
            
            <div class="test-card">
                <h3>âš¡ æ€§èƒ½æµ‹è¯•</h3>
                <button onclick="testLoadPerformance()">åŠ è½½æ€§èƒ½</button>
                <button onclick="testCacheHeaders()">ç¼“å­˜å¤´æµ‹è¯•</button>
                <div id="performance-results"></div>
            </div>
            
            <div class="test-card">
                <h3>ğŸ”§ å…¼å®¹æ€§æµ‹è¯•</h3>
                <button onclick="testBrowserCompatibility()">æµè§ˆå™¨å…¼å®¹æ€§</button>
                <button onclick="testMobileResponsive()">ç§»åŠ¨ç«¯å“åº”</button>
                <div id="compatibility-results"></div>
            </div>
        </div>

        <div class="test-card">
            <h3>ğŸ“Š ç»¼åˆæµ‹è¯•æŠ¥å‘Š</h3>
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
            <div id="comprehensive-report"></div>
        </div>
    </div>

    <script>
        // æµ‹è¯•é…ç½®
        const TEST_CONFIG = {
            baseUrl: window.location.origin,
            staticResources: [
                '/favicon.ico',
                '/logo.png',
                '/manifest.json',
                '/robots.txt',
                '/lensDirtTexture.jpg'
            ],
            textures: [
                '/textures/moon_2k.jpg',
                '/textures/sun_2k.jpg'
            ],
            apiEndpoints: [
                '/api/weather?location=Beijing',
                '/api/weather?location=Shanghai'
            ],
            buildFiles: [
                '/static/css/main.3b82f3a0.css',
                '/static/js/main.1afcc6b6.js',
                '/static/js/453.159e3252.chunk.js'
            ]
        };

        let testResults = [];

        // å·¥å…·å‡½æ•°
        function addResult(testName, success, details, data = null) {
            const result = { 
                testName, 
                success, 
                details, 
                data,
                timestamp: new Date().toLocaleTimeString() 
            };
            testResults.push(result);
            return result;
        }

        function formatResult(result) {
            const icon = result.success ? 'âœ…' : 'âŒ';
            const color = result.success ? 'success' : 'error';
            return `<div class="result ${color}">${icon} ${result.testName}: ${result.details}</div>`;
        }

        // é™æ€èµ„æºæµ‹è¯•
        async function testStaticResources() {
            const results = document.getElementById('static-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•é™æ€èµ„æº...</div>';
            
            let passed = 0;
            let total = 0;
            let html = '';

            for (const resource of TEST_CONFIG.staticResources) {
                total++;
                try {
                    const response = await fetch(resource, { method: 'HEAD' });
                    if (response.ok) {
                        passed++;
                        html += formatResult(addResult(resource, true, `çŠ¶æ€: ${response.status}`));
                    } else {
                        html += formatResult(addResult(resource, false, `çŠ¶æ€: ${response.status}`));
                    }
                } catch (error) {
                    html += formatResult(addResult(resource, false, `é”™è¯¯: ${error.message}`));
                }
            }

            for (const file of TEST_CONFIG.buildFiles) {
                total++;
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        passed++;
                        const size = response.headers.get('content-length');
                        html += formatResult(addResult(file, true, `çŠ¶æ€: ${response.status}, å¤§å°: ${size} bytes`));
                    } else {
                        html += formatResult(addResult(file, false, `çŠ¶æ€: ${response.status}`));
                    }
                } catch (error) {
                    html += formatResult(addResult(file, false, `é”™è¯¯: ${error.message}`));
                }
            }

            const percentage = Math.round((passed / total) * 100);
            results.innerHTML = `
                <div class="${percentage >= 90 ? 'success' : percentage >= 70 ? 'warning' : 'error'}">
                    ğŸ“Š é™æ€èµ„æºæµ‹è¯•å®Œæˆ: ${passed}/${total} (${percentage}%)
                </div>
                ${html}
            `;
        }

        // çº¹ç†æ–‡ä»¶æµ‹è¯•
        async function testTextures() {
            const results = document.getElementById('static-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•çº¹ç†æ–‡ä»¶...</div>';
            
            let passed = 0;
            let total = 0;
            let html = '';

            for (const texture of TEST_CONFIG.textures) {
                total++;
                try {
                    const response = await fetch(texture);
                    if (response.ok) {
                        passed++;
                        const size = response.headers.get('content-length');
                        const type = response.headers.get('content-type');
                        html += formatResult(addResult(texture, true, `ç±»å‹: ${type}, å¤§å°: ${size} bytes`));
                    } else {
                        html += formatResult(addResult(texture, false, `çŠ¶æ€: ${response.status}`));
                    }
                } catch (error) {
                    html += formatResult(addResult(texture, false, `é”™è¯¯: ${error.message}`));
                }
            }

            const percentage = Math.round((passed / total) * 100);
            results.innerHTML += `
                <div class="${percentage >= 90 ? 'success' : percentage >= 70 ? 'warning' : 'error'}">
                    ğŸ“Š çº¹ç†æµ‹è¯•å®Œæˆ: ${passed}/${total} (${percentage}%)
                </div>
                ${html}
            `;
        }

        // è·¯å¾„æµ‹è¯•
        async function testRelativePaths() {
            const results = document.getElementById('path-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•ç›¸å¯¹è·¯å¾„...</div>';
            
            const tests = [
                { name: 'æ ¹ç›®å½•è®¿é—®', path: '/' },
                { name: 'é™æ€æ–‡ä»¶', path: '/static/css/main.3b82f3a0.css' },
                { name: 'çº¹ç†æ–‡ä»¶', path: '/textures/moon_2k.jpg' },
                { name: 'APIç«¯ç‚¹', path: '/api/weather?location=Beijing' }
            ];

            let html = '';
            for (const test of tests) {
                try {
                    const response = await fetch(test.path);
                    html += formatResult(addResult(test.name, response.ok, `è·¯å¾„: ${test.path}, çŠ¶æ€: ${response.status}`));
                } catch (error) {
                    html += formatResult(addResult(test.name, false, `è·¯å¾„: ${test.path}, é”™è¯¯: ${error.message}`));
                }
            }

            results.innerHTML = html;
        }

        async function testAbsolutePaths() {
            const results = document.getElementById('path-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•ç»å¯¹è·¯å¾„...</div>';
            
            const baseUrl = window.location.origin;
            const tests = [
                { name: 'å®Œæ•´URLè®¿é—®', path: `${baseUrl}/` },
                { name: 'å®Œæ•´é™æ€æ–‡ä»¶', path: `${baseUrl}/static/css/main.3b82f3a0.css` },
                { name: 'å®Œæ•´çº¹ç†æ–‡ä»¶', path: `${baseUrl}/textures/moon_2k.jpg` }
            ];

            let html = '';
            for (const test of tests) {
                try {
                    const response = await fetch(test.path);
                    html += formatResult(addResult(test.name, response.ok, `çŠ¶æ€: ${response.status}`));
                } catch (error) {
                    html += formatResult(addResult(test.name, false, `é”™è¯¯: ${error.message}`));
                }
            }

            results.innerHTML += html;
        }

        // æ€§èƒ½æµ‹è¯•
        async function testLoadPerformance() {
            const results = document.getElementById('performance-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•åŠ è½½æ€§èƒ½...</div>';
            
            const testResources = [
                '/static/css/main.3b82f3a0.css',
                '/static/js/main.1afcc6b6.js',
                '/textures/moon_2k.jpg',
                '/textures/sun_2k.jpg'
            ];

            let html = '';
            let totalTime = 0;
            let totalSize = 0;

            for (const resource of testResources) {
                const startTime = performance.now();
                try {
                    const response = await fetch(resource);
                    const endTime = performance.now();
                    const loadTime = (endTime - startTime).toFixed(2);
                    const size = response.headers.get('content-length') || '0';
                    const sizeKB = (parseInt(size) / 1024).toFixed(2);
                    
                    totalTime += parseFloat(loadTime);
                    totalSize += parseInt(size);
                    
                    const speed = (parseInt(size) / 1024 / (loadTime / 1000)).toFixed(2);
                    html += formatResult(addResult(resource, true, `åŠ è½½æ—¶é—´: ${loadTime}ms, å¤§å°: ${sizeKB}KB, é€Ÿåº¦: ${speed}KB/s`));
                } catch (error) {
                    html += formatResult(addResult(resource, false, `åŠ è½½å¤±è´¥: ${error.message}`));
                }
            }

            const avgTime = (totalTime / testResources.length).toFixed(2);
            const totalSizeKB = (totalSize / 1024).toFixed(2);
            
            results.innerHTML = `
                <div class="info">ğŸ“Š æ€§èƒ½ç»Ÿè®¡:</div>
                <div class="info">å¹³å‡åŠ è½½æ—¶é—´: ${avgTime}ms</div>
                <div class="info">æ€»å¤§å°: ${totalSizeKB}KB</div>
                ${html}
            `;
        }

        async function testCacheHeaders() {
            const results = document.getElementById('performance-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•ç¼“å­˜å¤´...</div>';
            
            const testResources = [
                '/static/css/main.3b82f3a0.css',
                '/static/js/main.1afcc6b6.js',
                '/textures/moon_2k.jpg',
                '/index.html'
            ];

            let html = '';
            for (const resource of testResources) {
                try {
                    const response = await fetch(resource);
                    const headers = {
                        'cache-control': response.headers.get('cache-control'),
                        'etag': response.headers.get('etag'),
                        'last-modified': response.headers.get('last-modified'),
                        'expires': response.headers.get('expires')
                    };
                    
                    const hasCacheHeaders = headers['cache-control'] || headers['etag'] || headers['last-modified'];
                    const cacheInfo = JSON.stringify(headers, null, 2);
                    
                    html += formatResult(addResult(resource, !!hasCacheHeaders, `ç¼“å­˜å¤´: ${hasCacheHeaders ? 'å·²é…ç½®' : 'æœªé…ç½®'}`, headers));
                } catch (error) {
                    html += formatResult(addResult(resource, false, `é”™è¯¯: ${error.message}`));
                }
            }

            results.innerHTML += html;
        }

        // å…¼å®¹æ€§æµ‹è¯•
        function testBrowserCompatibility() {
            const results = document.getElementById('compatibility-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•æµè§ˆå™¨å…¼å®¹æ€§...</div>';
            
            const tests = [
                { name: 'WebGLæ”¯æŒ', test: () => !!window.WebGLRenderingContext },
                { name: 'WebGL2æ”¯æŒ', test: () => !!window.WebGL2RenderingContext },
                { name: 'åœ°ç†å®šä½', test: () => 'geolocation' in navigator },
                { name: 'Fetch API', test: () => 'fetch' in window },
                { name: 'Promiseæ”¯æŒ', test: () => 'Promise' in window },
                { name: 'LocalStorage', test: () => 'localStorage' in window },
                { name: 'ServiceWorker', test: () => 'serviceWorker' in navigator },
                { name: 'IntersectionObserver', test: () => 'IntersectionObserver' in window }
            ];

            let html = '';
            let passed = 0;
            
            for (const test of tests) {
                const success = test.test();
                if (success) passed++;
                html += formatResult(addResult(test.name, success, success ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'));
            }

            const percentage = Math.round((passed / tests.length) * 100);
            results.innerHTML = `
                <div class="${percentage >= 80 ? 'success' : percentage >= 60 ? 'warning' : 'error'}">
                    ğŸ“Š å…¼å®¹æ€§æµ‹è¯•: ${passed}/${tests.length} (${percentage}%) æ”¯æŒ
                </div>
                ${html}
            `;
        }

        function testMobileResponsive() {
            const results = document.getElementById('compatibility-results');
            results.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•ç§»åŠ¨ç«¯å“åº”...</div>';
            
            const viewport = window.innerWidth;
            const isMobile = viewport <= 768;
            const isTablet = viewport > 768 && viewport <= 1024;
            const isDesktop = viewport > 1024;
            
            const tests = [
                { name: 'è§†å£å®½åº¦', value: `${viewport}px`, success: true },
                { name: 'è®¾å¤‡ç±»å‹', value: isMobile ? 'ç§»åŠ¨ç«¯' : isTablet ? 'å¹³æ¿' : 'æ¡Œé¢ç«¯', success: true },
                { name: 'è§¦æ‘¸æ”¯æŒ', value: 'ontouchstart' in window ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ', success: 'ontouchstart' in window }
            ];

            let html = '';
            for (const test of tests) {
                html += formatResult(addResult(test.name, test.success, `${test.value}`));
            }

            results.innerHTML += html;
        }

        // ç»¼åˆæµ‹è¯•
        async function runAllTests() {
            const report = document.getElementById('comprehensive-report');
            report.innerHTML = '<div class="info">ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...</div>';
            
            testResults = []; // é‡ç½®ç»“æœ
            
            await testStaticResources();
            await testTextures();
            await testRelativePaths();
            await testAbsolutePaths();
            await testLoadPerformance();
            await testCacheHeaders();
            testBrowserCompatibility();
            testMobileResponsive();
            
            // ç”ŸæˆæŠ¥å‘Š
            const total = testResults.length;
            const passed = testResults.filter(r => r.success).length;
            const failed = total - passed;
            const percentage = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            const summary = `
                <div class="test-card">
                    <h3>ğŸ“ˆ æµ‹è¯•æ€»ç»“</h3>
                    <div class="${percentage >= 90 ? 'success' : percentage >= 70 ? 'warning' : 'error'}">
                        <strong>æ€»ä½“é€šè¿‡ç‡: ${percentage}% (${passed}/${total})</strong>
                    </div>
                    <div>âœ… é€šè¿‡: ${passed}</div>
                    <div>âŒ å¤±è´¥: ${failed}</div>
                    <div>ğŸ“Š æ€»æµ‹è¯•æ•°: ${total}</div>
                </div>
            `;
            
            report.innerHTML = summary;
            
            // å»ºè®®
            if (percentage < 90) {
                report.innerHTML += `
                    <div class="test-card">
                        <h3>ğŸ’¡ æ”¹è¿›å»ºè®®</h3>
                        <div class="warning">
                            <ul>
                                ${percentage < 90 ? '<li>æ£€æŸ¥é™æ€èµ„æºè·¯å¾„é…ç½®</li>' : ''}
                                ${percentage < 80 ? '<li>éªŒè¯æ„å»ºè¿‡ç¨‹æ˜¯å¦æ­£ç¡®</li>' : ''}
                                ${percentage < 70 ? '<li>æ£€æŸ¥Nginxé…ç½®å’Œæ–‡ä»¶æƒé™</li>' : ''}
                                <li>ç¡®ä¿æ‰€æœ‰èµ„æºæ–‡ä»¶å·²æ­£ç¡®éƒ¨ç½²</li>
                                <li>æ£€æŸ¥ç¼“å­˜ç­–ç•¥æ˜¯å¦åˆç†</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }

        function clearResults() {
            document.getElementById('static-results').innerHTML = '';
            document.getElementById('path-results').innerHTML = '';
            document.getElementById('performance-results').innerHTML = '';
            document.getElementById('compatibility-results').innerHTML = '';
            document.getElementById('comprehensive-report').innerHTML = '';
            testResults = [];
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testBrowserCompatibility();
                testMobileResponsive();
            }, 1000);
        });
    </script>
</body>
</html>